<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BARPLAY ‚Äî –ê—Ä–∫–∞–¥–Ω–∞—è –∏–≥—Ä–∞ –¥–ª—è –±–∞—Ä–æ–≤ | –ë–æ–ª—å—à–µ –≤—ã—Ä—É—á–∫–∏ –±–µ–∑ –≤–ª–æ–∂–µ–Ω–∏–π</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Rubik:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root{--pk:#FF2D6B;--cy:#00FFF7;--yw:#FFE033;--gn:#39FF14;--pr:#B026FF;--or:#FF6B2D;
            --bg:#0A0A12;--bgc:#111120;--bgch:#16162A;--bd:rgba(255,255,255,.06);
            --t1:#EEEEF5;--t2:#7A7A9A;--t3:#44445A;--pxf:'Press Start 2P',monospace;--bf:'Rubik',sans-serif;}
        *{margin:0;padding:0;box-sizing:border-box;}
        html{scroll-behavior:smooth;}
        body{background:var(--bg);color:var(--t1);font-family:var(--bf);overflow-x:hidden;line-height:1.6;}
        body::after{content:'';position:fixed;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,.03) 2px,rgba(0,0,0,.03) 4px);pointer-events:none;z-index:10000;}
        body::before{content:'';position:fixed;inset:0;background-image:radial-gradient(circle 1px,rgba(255,255,255,.015) 1px,transparent 1px);background-size:24px 24px;pointer-events:none;}

        @keyframes g1{0%,100%{clip-path:inset(0 0 96% 0);transform:translate(0)}20%{clip-path:inset(20% 0 60% 0);transform:translate(-4px,2px)}40%{clip-path:inset(50% 0 30% 0);transform:translate(4px,-1px)}60%{clip-path:inset(70% 0 10% 0);transform:translate(-2px,3px)}80%{clip-path:inset(10% 0 80% 0);transform:translate(3px,-2px)}}
        @keyframes g2{0%,100%{clip-path:inset(96% 0 0 0);transform:translate(0)}20%{clip-path:inset(60% 0 20% 0);transform:translate(4px,-2px)}40%{clip-path:inset(30% 0 50% 0);transform:translate(-3px,1px)}60%{clip-path:inset(10% 0 70% 0);transform:translate(2px,-3px)}80%{clip-path:inset(80% 0 5% 0);transform:translate(-4px,2px)}}
        @keyframes flicker{0%,100%{opacity:1}93%{opacity:.7}94%{opacity:1}96%{opacity:.85}97%{opacity:1}}
        @keyframes blink{0%,100%{opacity:1}50%{opacity:0}}
        @keyframes fadeUp{from{opacity:0;transform:translateY(35px)}to{opacity:1;transform:translateY(0)}}
        @keyframes pixel-rain{0%{transform:translateY(-100%);opacity:0}10%{opacity:1}90%{opacity:1}100%{transform:translateY(calc(100vh+100%));opacity:0}}
        @keyframes crt-on{0%{transform:scaleY(.005) scaleX(0);opacity:0}30%{transform:scaleY(.005) scaleX(1);opacity:.5}60%{transform:scaleY(1) scaleX(1);filter:brightness(3)}100%{transform:scaleY(1) scaleX(1);filter:brightness(1)}}
        @keyframes flag-wave{0%,100%{transform:skewX(0)}50%{transform:skewX(-5deg)}}
        @keyframes walk{0%,100%{transform:translateY(0)}50%{transform:translateY(-3px)}}

        .scroll-bar{position:fixed;top:0;left:0;height:3px;z-index:10002;background:linear-gradient(90deg,var(--pk),var(--cy),var(--yw),var(--gn));transition:width .05s;}

        nav{position:fixed;top:0;left:0;right:0;z-index:1000;padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center;background:rgba(10,10,18,.85);backdrop-filter:blur(16px);border-bottom:1px solid var(--bd);transition:padding .3s;}
        nav.sc{padding:.6rem 2rem;}
        .logo{font-family:var(--pxf);font-size:1rem;color:var(--cy);text-shadow:0 0 10px var(--cy),0 0 30px rgba(0,255,247,.3);text-decoration:none;animation:flicker 8s infinite;}
        .logo .pk{color:var(--pk);text-shadow:0 0 10px var(--pk),0 0 30px rgba(255,45,107,.3);}
        .nl{display:flex;gap:2rem;align-items:center;}
        .nl a{color:var(--t2);text-decoration:none;font-size:.85rem;font-weight:600;transition:all .3s;}
        .nl a:hover{color:var(--cy);}
        .btn-cta{font-family:var(--pxf);font-size:.55rem;background:var(--pk);color:#fff!important;padding:.7rem 1.2rem;border:2px solid var(--pk);transition:all .3s;text-decoration:none;cursor:pointer;}
        .btn-cta:hover{background:transparent;color:var(--pk)!important;box-shadow:0 0 20px rgba(255,45,107,.4);}
        .burger{display:none;flex-direction:column;gap:5px;cursor:pointer;z-index:1001;background:none;border:none;padding:4px;}
        .burger span{display:block;width:28px;height:2px;background:var(--cy);transition:all .3s;}
        .burger.on span:nth-child(1){transform:rotate(45deg) translate(5px,5px);}
        .burger.on span:nth-child(2){opacity:0;}
        .burger.on span:nth-child(3){transform:rotate(-45deg) translate(5px,-5px);}
        .mob-menu{display:none;position:fixed;inset:0;background:rgba(10,10,18,.97);z-index:999;flex-direction:column;align-items:center;justify-content:center;gap:2rem;}
        .mob-menu.on{display:flex;}
        .mob-menu a{font-family:var(--pxf);font-size:.75rem;color:var(--t1);text-decoration:none;transition:color .3s;}
        .mob-menu a:hover{color:var(--cy);}

        /* HERO */
        .hero{min-height:100vh;display:flex;align-items:center;position:relative;padding:7rem 2rem 4rem;overflow:hidden;}
        .hero-bg{position:absolute;inset:0;background:radial-gradient(ellipse 70% 50% at 30% 40%,rgba(255,45,107,.08) 0%,transparent 60%),radial-gradient(ellipse 50% 40% at 80% 60%,rgba(0,255,247,.06) 0%,transparent 60%);}
        .pixel-rain{position:absolute;inset:0;overflow:hidden;pointer-events:none;}
        .pixel-drop{position:absolute;width:4px;height:4px;animation:pixel-rain linear infinite;}
        .hero-inner{max-width:1200px;margin:0 auto;position:relative;z-index:2;width:100%;}
        .hero-badge{display:inline-flex;align-items:center;gap:.6rem;font-family:var(--pxf);font-size:.5rem;color:var(--yw);border:1px solid rgba(255,224,51,.3);padding:.6rem 1rem;margin-bottom:1.5rem;background:rgba(255,224,51,.05);animation:fadeUp .6s ease both;}
        .hero-badge::before{content:'‚ñ∫';animation:blink 1s infinite;}
        .hero-title{font-family:var(--bf);font-weight:900;font-size:clamp(2.2rem,5vw,4.2rem);line-height:1.1;margin-bottom:1.5rem;text-transform:uppercase;animation:fadeUp .6s ease .1s both;}
        .gt{position:relative;display:inline-block;color:var(--cy);text-shadow:0 0 10px var(--cy),0 0 40px rgba(0,255,247,.2);}
        .gt::before,.gt::after{content:attr(data-t);position:absolute;left:0;top:0;width:100%;height:100%;}
        .gt::before{color:var(--pk);animation:g1 4s infinite linear;text-shadow:none;}
        .gt::after{color:var(--gn);animation:g2 4s infinite linear;text-shadow:none;}
        .hero-sub{font-size:1.1rem;color:var(--t2);max-width:520px;line-height:1.7;margin-bottom:2rem;animation:fadeUp .6s ease .2s both;}
        .hero-actions{display:flex;gap:1rem;flex-wrap:wrap;margin-bottom:3rem;animation:fadeUp .6s ease .3s both;}
        .btn-play{font-family:var(--pxf);font-size:.65rem;background:var(--cy);color:var(--bg);padding:1rem 2rem;border:3px solid var(--cy);cursor:pointer;transition:all .3s;text-decoration:none;display:inline-flex;align-items:center;gap:.7rem;position:relative;overflow:hidden;}
        .btn-play::after{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);transition:left .5s;}
        .btn-play:hover::after{left:100%;}
        .btn-play:hover{box-shadow:0 0 30px rgba(0,255,247,.5);transform:translateY(-2px);}
        .btn-ghost{font-family:var(--pxf);font-size:.55rem;background:transparent;color:var(--t1);padding:1rem 1.5rem;border:2px solid var(--bd);cursor:pointer;transition:all .3s;text-decoration:none;display:inline-flex;align-items:center;gap:.5rem;}
        .btn-ghost:hover{border-color:var(--pk);color:var(--pk);}
        .hero-stats{display:flex;gap:2.5rem;padding-top:2rem;border-top:1px dashed var(--bd);animation:fadeUp .6s ease .5s both;}
        .sv{font-family:var(--pxf);font-size:1rem;line-height:1;}
        .sv.c{color:var(--cy);text-shadow:0 0 10px rgba(0,255,247,.3);}
        .sv.p{color:var(--pk);text-shadow:0 0 10px rgba(255,45,107,.3);}
        .sv.y{color:var(--yw);text-shadow:0 0 10px rgba(255,224,51,.3);}
        .sl{font-size:.8rem;color:var(--t3);margin-top:.5rem;}

        /* ============= GAME SECTION ‚Äî REDESIGNED ============= */
        .game-section{padding:4rem 2rem 5rem;position:relative;}
        .game-section .s-inner{max-width:1100px;margin:0 auto;}

        .game-wrapper{position:relative;max-width:800px;margin:2rem auto 0;}

        /* Bar scene frame around the game */
        .bar-frame{position:relative;border:3px solid #2a2540;background:#0a0812;overflow:hidden;border-radius:4px;
            box-shadow:0 0 40px rgba(0,255,247,.1),0 20px 60px rgba(0,0,0,.5);}

        /* The actual game canvas ‚Äî enforced 16:9 aspect ratio */
        .game-canvas-container{position:relative;width:100%;padding-top:56.25%;/* 16:9 */background:#000;}
        .game-canvas-container canvas{position:absolute;top:0;left:0;width:100%;height:100%;display:block;}

        /* HUD overlay on canvas */
        .g-hud{position:absolute;top:0;left:0;right:0;padding:8px 12px;display:flex;justify-content:space-between;align-items:center;z-index:5;pointer-events:none;}
        .g-hud span{font-family:var(--pxf);font-size:clamp(.45rem,1.2vw,.7rem);color:var(--yw);text-shadow:0 0 8px rgba(255,224,51,.6),0 1px 2px rgba(0,0,0,.8);}

        /* Win overlay */
        .win-overlay{position:absolute;inset:0;z-index:10;display:none;flex-direction:column;align-items:center;justify-content:center;background:rgba(0,0,0,.85);backdrop-filter:blur(4px);}
        .win-overlay.on{display:flex;}
        .win-overlay h3{font-family:var(--pxf);font-size:clamp(.8rem,2vw,1.3rem);color:var(--gn);text-shadow:0 0 20px var(--gn);margin-bottom:.8rem;}
        .win-overlay .prize-text{font-family:var(--pxf);font-size:clamp(.4rem,1vw,.65rem);color:var(--yw);margin-bottom:1.2rem;text-align:center;line-height:2;}
        .win-btn{font-family:var(--pxf);font-size:clamp(.4rem,.9vw,.55rem);background:var(--cy);color:var(--bg);border:none;padding:.6rem 1.5rem;cursor:pointer;transition:all .3s;}
        .win-btn:hover{box-shadow:0 0 20px rgba(0,255,247,.5);}

        /* Bar ambient elements around the frame */
        .bar-ambient{display:flex;justify-content:space-between;align-items:flex-end;padding:0 1rem;margin-top:-2px;position:relative;z-index:2;}
        .bar-counter-strip{width:100%;height:24px;background:linear-gradient(180deg,#1a1530,#0f0d18);border-top:2px solid #2a2540;display:flex;align-items:center;justify-content:center;gap:2rem;padding:0 1rem;}
        .bar-silhouette{display:flex;gap:4px;align-items:flex-end;}
        .sil{background:#1a1828;border-radius:4px 4px 0 0;}
        .sil.s1{width:14px;height:20px;}.sil.s2{width:10px;height:16px;}.sil.s3{width:12px;height:22px;}
        .sil-head{width:8px;height:8px;background:#1a1828;border-radius:50%;margin:0 auto -2px;position:relative;top:-6px;}
        .bar-glass{width:8px;height:12px;background:linear-gradient(180deg,rgba(255,200,50,.25),rgba(255,180,30,.1));border:1px solid rgba(255,200,50,.2);border-radius:1px;}

        /* Game controls hint */
        .game-controls{text-align:center;margin-top:1.2rem;}
        .game-controls-hint{font-family:var(--pxf);font-size:.45rem;color:var(--t3);letter-spacing:.05em;}
        .touch-controls{display:none;justify-content:center;margin-top:1rem;}
        .touch-btn{width:100%;max-width:400px;height:60px;border:2px solid var(--cy);background:rgba(0,255,247,.08);color:var(--cy);font-family:var(--pxf);font-size:.7rem;cursor:pointer;display:flex;align-items:center;justify-content:center;user-select:none;-webkit-user-select:none;transition:all .1s;touch-action:manipulation;}
        .touch-btn:active{background:rgba(0,255,247,.25);box-shadow:0 0 20px rgba(0,255,247,.3);}

        /* SECTIONS */
        section{padding:6rem 2rem;position:relative;}
        .s-inner{max-width:1200px;margin:0 auto;}
        .s-label{font-family:var(--pxf);font-size:.55rem;color:var(--pk);letter-spacing:.1em;margin-bottom:1rem;text-transform:uppercase;}
        .s-title{font-family:var(--bf);font-weight:900;text-transform:uppercase;font-size:clamp(1.8rem,3.5vw,2.8rem);line-height:1.15;margin-bottom:1rem;}
        .s-desc{font-size:1.05rem;color:var(--t2);max-width:550px;}
        .reveal{opacity:0;transform:translateY(35px);transition:all .7s cubic-bezier(.16,1,.3,1);}
        .reveal.vis{opacity:1;transform:translateY(0);}
        .pixel-divider{display:flex;justify-content:center;gap:6px;padding:1rem 0;}
        .pixel-divider span{width:8px;height:8px;display:block;}

        .how-section{background:linear-gradient(180deg,var(--bg),#0d0d18,var(--bg));}
        .steps-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1.5rem;margin-top:3.5rem;}
        .step-card{background:var(--bgc);border:2px solid var(--bd);padding:2rem 1.5rem;position:relative;overflow:hidden;transition:all .4s;}
        .step-card::before{content:'';position:absolute;top:0;left:0;width:12px;height:12px;border-top:3px solid var(--cy);border-left:3px solid var(--cy);}
        .step-card::after{content:'';position:absolute;bottom:0;right:0;width:12px;height:12px;border-bottom:3px solid var(--cy);border-right:3px solid var(--cy);}
        .step-card:hover{border-color:rgba(0,255,247,.2);transform:translateY(-4px);}
        .step-card:nth-child(2)::before,.step-card:nth-child(2)::after{border-color:var(--pk);}
        .step-card:nth-child(3)::before,.step-card:nth-child(3)::after{border-color:var(--yw);}
        .step-num{font-family:var(--pxf);font-size:2rem;color:rgba(0,255,247,.12);line-height:1;margin-bottom:1rem;}
        .step-card:nth-child(2) .step-num{color:rgba(255,45,107,.12);}
        .step-card:nth-child(3) .step-num{color:rgba(255,224,51,.12);}
        .step-emoji{font-size:2rem;margin-bottom:.75rem;}
        .step-card h3{font-weight:800;font-size:1.1rem;text-transform:uppercase;margin-bottom:.6rem;}
        .step-card p{color:var(--t2);font-size:.9rem;line-height:1.7;}

        .benefits-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:1.5rem;margin-top:3.5rem;}
        .b-card{background:var(--bgc);border:2px solid var(--bd);padding:2rem;transition:all .4s;}
        .b-card:hover{border-color:rgba(0,255,247,.15);background:var(--bgch);}
        .b-card.wide{grid-column:1/-1;border-color:rgba(0,255,247,.15);background:linear-gradient(135deg,rgba(0,255,247,.03),rgba(255,45,107,.02));}
        .b-icon{width:44px;height:44px;display:flex;align-items:center;justify-content:center;font-size:1.4rem;margin-bottom:1rem;border:2px solid var(--bd);}
        .b-card h3{font-weight:800;font-size:1.05rem;text-transform:uppercase;margin-bottom:.5rem;}
        .b-card p{color:var(--t2);font-size:.9rem;line-height:1.7;}

        /* ============= ECONOMICS ‚Äî CLEAN MIDDLE ============= */
        .eco-section{background:linear-gradient(180deg,var(--bg),#08081a,var(--bg));}
        .eco-grid{display:grid;grid-template-columns:1.2fr 1fr;gap:3rem;margin-top:3.5rem;align-items:start;}
        .eco-calc{background:var(--bgc);border:2px solid var(--bd);padding:2.5rem;position:relative;overflow:hidden;}
        .eco-calc::before{content:'';position:absolute;top:-2px;left:-2px;right:-2px;height:4px;background:linear-gradient(90deg,var(--cy),var(--pk),var(--yw));}
        .eco-calc-title{font-family:var(--pxf);font-size:.55rem;color:var(--cy);margin-bottom:1.5rem;letter-spacing:.05em;}
        .eco-row{display:flex;justify-content:space-between;align-items:center;padding:.7rem 0;border-bottom:1px dashed rgba(255,255,255,.04);}
        .eco-row:last-child{border-bottom:none;}
        .eco-row.total{border-top:2px solid rgba(57,255,20,.3);border-bottom:none;padding-top:1rem;margin-top:.5rem;}
        .eco-key{color:var(--t2);font-size:.9rem;display:flex;align-items:center;gap:.4rem;}
        .eco-key .em{font-size:1rem;}
        .eco-val{font-family:var(--pxf);font-size:.6rem;color:var(--t1);text-align:right;white-space:nowrap;}
        .eco-val.dim{color:var(--t3);font-size:.5rem;}
        .eco-val.hl{color:var(--cy);font-size:.7rem;text-shadow:0 0 10px rgba(0,255,247,.3);}
        .eco-val.big{color:var(--gn);font-size:.85rem;text-shadow:0 0 15px rgba(57,255,20,.3);}
        .eco-val.sub{display:block;font-size:.45rem;color:var(--cy);margin-top:.2rem;}
        .eco-note{margin-top:1.5rem;padding:1rem;background:rgba(0,255,247,.04);border:1px dashed rgba(0,255,247,.15);font-size:.85rem;color:var(--t2);line-height:1.7;}
        .eco-note strong{color:var(--cy);}
        .eco-side{display:flex;flex-direction:column;gap:1.2rem;}
        .eco-hi{display:flex;align-items:center;gap:1.2rem;background:var(--bgc);border:2px solid var(--bd);padding:1.3rem;transition:all .3s;}
        .eco-hi:hover{border-color:rgba(0,255,247,.15);transform:translateX(4px);}
        .eco-hi-num{font-family:var(--pxf);font-size:.9rem;color:var(--cy);min-width:80px;text-shadow:0 0 10px rgba(0,255,247,.3);}
        .eco-hi-text{font-size:.85rem;color:var(--t2);line-height:1.5;}
        .eco-hi-text strong{color:var(--t1);display:block;margin-bottom:.15rem;}

        .proof-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1.5rem;margin-top:3.5rem;}
        .proof-card{background:var(--bgc);border:2px solid var(--bd);padding:2rem;transition:all .3s;}
        .proof-card:hover{border-color:rgba(255,45,107,.15);}
        .proof-stars{font-family:var(--pxf);font-size:.45rem;color:var(--yw);margin-bottom:1rem;}
        .proof-text{color:var(--t2);font-size:.9rem;line-height:1.8;margin-bottom:1.2rem;font-style:italic;}
        .proof-who{display:flex;align-items:center;gap:.7rem;}
        .proof-ava{width:36px;height:36px;background:linear-gradient(135deg,var(--pk),var(--cy));display:flex;align-items:center;justify-content:center;font-family:var(--pxf);font-size:.45rem;color:var(--bg);}
        .proof-name{font-weight:700;font-size:.85rem;}
        .proof-role{font-size:.75rem;color:var(--t3);}

        .gp-section{background:linear-gradient(180deg,var(--bg),#0d0d18);overflow:hidden;padding:6rem 2rem 4rem;}
        .dk-wrapper{position:relative;max-width:900px;margin:3rem auto 0;border:4px solid #E84080;border-radius:2px;background:#000;box-shadow:0 0 60px rgba(232,64,128,.15),0 0 120px rgba(0,216,216,.08),0 20px 60px rgba(0,0,0,.6);}
        .dk-wrapper canvas{display:block;width:100%;height:auto;}
        .faq-list{max-width:800px;margin:3.5rem auto 0;}
        .faq-item{border-bottom:1px dashed var(--bd);}
        .faq-q{width:100%;background:none;border:none;color:var(--t1);padding:1.3rem 0;font-size:1rem;font-weight:700;text-align:left;cursor:pointer;display:flex;justify-content:space-between;align-items:center;font-family:var(--bf);transition:color .3s;text-transform:uppercase;}
        .faq-q:hover{color:var(--cy);}
        .faq-icon{font-family:var(--pxf);font-size:.7rem;color:var(--cy);transition:transform .3s;flex-shrink:0;margin-left:1rem;}
        .faq-item.on .faq-icon{transform:rotate(45deg);color:var(--pk);}
        .faq-a{max-height:0;overflow:hidden;transition:max-height .4s ease;}
        .faq-item.on .faq-a{max-height:300px;}
        .faq-a p{color:var(--t2);line-height:1.8;font-size:.9rem;padding-bottom:1.3rem;}

        .cta-section{padding:7rem 2rem;text-align:center;position:relative;overflow:hidden;}
        .cta-bg{position:absolute;inset:0;background:radial-gradient(ellipse 50% 40% at 50% 50%,rgba(0,255,247,.06) 0%,transparent 70%);}
        .cta-section .s-inner{position:relative;z-index:2;}

        .overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);backdrop-filter:blur(10px);z-index:5000;align-items:center;justify-content:center;padding:2rem;}
        .overlay.on{display:flex;}
        .modal{background:var(--bgc);border:2px solid var(--cy);padding:2.5rem;max-width:480px;width:100%;position:relative;animation:crt-on .4s ease;}
        .modal::before{content:'';position:absolute;top:-2px;left:-2px;right:-2px;height:4px;background:linear-gradient(90deg,var(--cy),var(--pk),var(--yw));}
        .modal-x{position:absolute;top:1rem;right:1rem;background:none;border:none;color:var(--t3);font-family:var(--pxf);font-size:.8rem;cursor:pointer;transition:color .3s;}
        .modal-x:hover{color:var(--pk);}
        .modal h2{font-family:var(--pxf);font-size:.75rem;color:var(--cy);margin-bottom:.5rem;}
        .modal .ms{color:var(--t2);margin-bottom:1.5rem;font-size:.9rem;}
        .fg{margin-bottom:1rem;}
        .fg label{display:block;font-family:var(--pxf);font-size:.4rem;color:var(--t3);margin-bottom:.5rem;letter-spacing:.1em;text-transform:uppercase;}
        .fg input,.fg textarea{width:100%;padding:.8rem;background:var(--bg);border:2px solid var(--bd);color:var(--t1);font-size:.9rem;font-family:var(--bf);outline:none;transition:border-color .3s;}
        .fg input:focus,.fg textarea:focus{border-color:var(--cy);box-shadow:0 0 10px rgba(0,255,247,.1);}
        .fg textarea{resize:vertical;min-height:70px;}
        .form-ok{display:none;text-align:center;padding:1.5rem 0;}
        .form-ok.on{display:block;}.form-fields.off{display:none;}
        .form-ok h3{font-family:var(--pxf);font-size:.7rem;color:var(--gn);margin-bottom:.5rem;}
        .form-ok p{color:var(--t2);font-size:.9rem;}
        .modal form{display:flex;flex-direction:column;gap:0;}
        footer{padding:2.5rem 2rem;border-top:1px dashed var(--bd);text-align:center;}
        footer p{font-family:var(--pxf);font-size:.4rem;color:var(--t3);}

        @media(max-width:1024px){.nl{display:none;}.burger{display:flex;}}
        @media(max-width:768px){
            section{padding:4rem 1.2rem;}
            .steps-grid,.benefits-grid,.proof-grid{grid-template-columns:1fr;}
            .eco-grid{grid-template-columns:1fr;}
            .hero{padding:6rem 1.2rem 3rem;}.hero-stats{flex-direction:column;gap:1.2rem;}
            .touch-controls{display:flex;}
            .lm-row,.lm-row.rev{flex-direction:column;min-height:auto;margin-bottom:1rem;}
            .lm-connector{width:4px;height:30px;flex:none;}.lm-node{width:100%;}.lm-icon,.lm-spacer{display:none;}
            .bar-ambient{display:none;}
        }
    </style>
</head>
<body>
<div class="scroll-bar" id="sBar"></div>
<nav id="nav">
    <a href="#" class="logo">BAR<span class="pk">PLAY</span></a>
    <div class="nl"><a href="#how">–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç</a><a href="#benefits">–í—ã–≥–æ–¥—ã</a><a href="#eco">–≠–∫–æ–Ω–æ–º–∏–∫–∞</a><a href="#faq">FAQ</a><a class="btn-cta" href="#" onclick="openM();return false;">START GAME</a></div>
    <button class="burger" id="burger" onclick="togMenu()"><span></span><span></span><span></span></button>
</nav>
<div class="mob-menu" id="mm"><a href="#how" onclick="togMenu()">–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç</a><a href="#benefits" onclick="togMenu()">–í—ã–≥–æ–¥—ã</a><a href="#eco" onclick="togMenu()">–≠–∫–æ–Ω–æ–º–∏–∫–∞</a><a href="#faq" onclick="togMenu()">FAQ</a><a class="btn-cta" href="#" onclick="openM();togMenu();return false;" style="margin-top:1rem;">START GAME</a></div>

<section class="hero">
    <div class="hero-bg"></div><div class="pixel-rain" id="pxRain"></div>
    <div class="hero-inner"><div>
        <div class="hero-badge">PLAYER 1 ‚Äî INSERT COIN</div>
        <h1 class="hero-title">–ê–†–ö–ê–î–ê –í –í–ê–®–ï–ú –ë–ê–†–ï<br><span class="gt" data-t="+10-15% –ö –í–´–†–£–ß–ö–ï">+10-15% –ö –í–´–†–£–ß–ö–ï</span></h1>
        <p class="hero-sub">–ì–æ—Å—Ç–∏ –ø–æ–∫—É–ø–∞—é—Ç –Ω–∞–ø–∏—Ç–æ–∫, –∏–≥—Ä–∞—é—Ç –≤ Flappy Beer –Ω–∞ –ø—Ä–æ–µ–∫—Ç–æ—Ä–µ –∏ –≤—ã–∏–≥—Ä—ã–≤–∞—é—Ç –ø—Ä–∏–∑—ã. –ú—ã –ø—Ä–∏–≤–æ–∑–∏–º –≤—Å—ë –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ ‚Äî –æ—Ç –≤–∞—Å –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ Wi-Fi.</p>
        <div class="hero-actions"><a href="#" class="btn-play" onclick="openM();return false;">‚ñ∂ –ü–û–õ–£–ß–ò–¢–¨ –î–ï–ú–û</a><a href="#game-demo" class="btn-ghost">üç∫ –ü–û–ü–†–û–ë–û–í–ê–¢–¨ –ò–ì–†–£</a></div>
        <div class="hero-stats"><div><div class="sv c">+10-15%</div><div class="sl">–∫ –º–µ—Å—è—á–Ω–æ–π –≤—ã—Ä—É—á–∫–µ</div></div><div><div class="sv p">0 ‚ÇΩ</div><div class="sl">–Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ Wi-Fi</div></div><div><div class="sv y">1 –î–ï–ù–¨</div><div class="sl">–Ω–∞ –ø–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫</div></div></div>
    </div></div>
</section>

<div class="pixel-divider"><span style="background:var(--cy)"></span><span style="background:var(--pk)"></span><span style="background:var(--yw)"></span><span style="background:var(--gn)"></span><span style="background:var(--pr)"></span><span style="background:var(--cy)"></span></div>

<!-- GAME -->
<section class="game-section" id="game-demo">
    <div class="s-inner">
        <div class="s-label reveal" style="text-align:center;">// DEMO MODE</div>
        <h2 class="s-title reveal" style="text-align:center;">–ü–û–ü–†–û–ë–£–ô–¢–ï –°–ê–ú–ò ‚Äî FLAPPY BEER</h2>
        <p class="s-desc reveal" style="text-align:center;margin:0 auto;">–ü—Ä–æ–ª–µ—Ç–∏—Ç–µ 10 —Ç—Ä—É–± –∏ –ø–æ–ª—É—á–∏—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –Ω–∞–ø–∏—Ç–æ–∫. –ò–º–µ–Ω–Ω–æ —Ç–∞–∫ —ç—Ç–æ –≤–∏–¥—è—Ç –≥–æ—Å—Ç–∏ –≤ –±–∞—Ä–µ.</p>
        <div class="game-wrapper reveal">
            <div class="bar-frame">
                <div class="game-canvas-container">
                    <canvas id="gameCanvas"></canvas>
                    <div class="g-hud"><span id="hudScore">SCORE: 0</span><span id="hudBest">BEST: 0</span></div>
                    <div class="win-overlay" id="winOverlay">
                        <h3>üç∫ YOU WIN! üç∫</h3>
                        <div class="prize-text">10 –¢–†–£–ë –ü–†–û–ô–î–ï–ù–û!<br>–í–ê–® –ü–†–ò–ó ‚Äî –ë–ï–°–ü–õ–ê–¢–ù–´–ô –ù–ê–ü–ò–¢–û–ö</div>
                        <button class="win-btn" onclick="restartGame()">‚ñ∂ –ò–ì–†–ê–¢–¨ –ï–©–Å</button>
                    </div>
                </div>
            </div>
            <div class="bar-ambient">
                <div class="bar-counter-strip">
                    <div class="bar-silhouette"><div class="sil s1"><div class="sil-head"></div></div><div class="sil s2"><div class="sil-head"></div></div></div>
                    <div class="bar-glass"></div><div class="bar-glass"></div>
                    <div class="bar-silhouette"><div class="sil s3"><div class="sil-head"></div></div><div class="sil s1"><div class="sil-head"></div></div></div>
                    <div class="bar-glass"></div>
                    <div class="bar-silhouette"><div class="sil s2"><div class="sil-head"></div></div></div>
                </div>
            </div>
        </div>
        <div class="game-controls reveal"><div class="game-controls-hint">–ü–†–û–ë–ï–õ / –ö–õ–ò–ö / TAP ‚Äî –ü–†–´–ñ–û–ö</div></div>
        <div class="touch-controls" id="touchCtrl"><button class="touch-btn" ontouchstart="flap()" onmousedown="flap()">TAP ‚Äî –ü–†–´–ñ–û–ö üç∫</button></div>
    </div>
</section>

<section class="how-section" id="how"><div class="s-inner">
    <div class="s-label reveal">// LEVEL 1</div><h2 class="s-title reveal">–ö–ê–ö –≠–¢–û –†–ê–ë–û–¢–ê–ï–¢</h2><p class="s-desc reveal">–¢—Ä–∏ —à–∞–≥–∞ ‚Äî –∏ –≤–∞—à –±–∞—Ä —É–∂–µ –Ω–µ —Ç–∞–∫–æ–π –∫–∞–∫ –≤—Å–µ. –û—Ç –≤–∞—Å ‚Äî —Ç–æ–ª—å–∫–æ Wi-Fi.</p>
    <div class="steps-grid">
        <div class="step-card reveal"><div class="step-num">01</div><div class="step-emoji">üç∫</div><h3>–ì–æ—Å—Ç—å –ø–æ–∫—É–ø–∞–µ—Ç –Ω–∞–ø–∏—Ç–æ–∫</h3><p>–ë–∞—Ä–º–µ–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –ø–æ–∫—É–ø–∫—É ‚Äî –≥–æ—Å—Ç—å –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∞—Ä–∫–∞–¥–µ —á–µ—Ä–µ–∑ —Å–º–∞—Ä—Ç—Ñ–æ–Ω.</p></div>
        <div class="step-card reveal"><div class="step-num">02</div><div class="step-emoji">üéÆ</div><h3>–ò–≥—Ä–∞–µ—Ç –Ω–∞ –ø—Ä–æ–µ–∫—Ç–æ—Ä–µ</h3><p>Flappy Beer –Ω–∞ –±–æ–ª—å—à–æ–º —ç–∫—Ä–∞–Ω–µ. –û–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞. –í–µ—Å—å –±–∞—Ä –≤–∏–¥–∏—Ç –∏ –±–æ–ª–µ–µ—Ç.</p></div>
        <div class="step-card reveal"><div class="step-num">03</div><div class="step-emoji">üèÜ</div><h3>–ù–∞–±–∏—Ä–∞–µ—Ç –æ—á–∫–∏ = –ø—Ä–∏–∑</h3><p>–ü—Ä–æ–ª–µ—Ç–µ–ª 10 —Ç—Ä—É–± ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –Ω–∞–ø–∏—Ç–æ–∫. –ù–µ —Ö–≤–∞—Ç–∏–ª–æ ‚Äî –ø–æ–∫—É–ø–∞–µ—Ç –µ—â—ë –∏ –ø—Ä–æ–±—É–µ—Ç —Å–Ω–æ–≤–∞.</p></div>
    </div>
</div></section>

<section id="benefits"><div class="s-inner">
    <div class="s-label reveal">// POWER-UPS</div><h2 class="s-title reveal">–ó–ê–ß–ï–ú –≠–¢–û –í–ê–®–ï–ú–£ –ë–ê–†–£</h2>
    <div class="benefits-grid">
        <div class="b-card wide reveal"><div class="b-icon">üìà</div><h3>+10-15% –∫ –º–µ—Å—è—á–Ω–æ–π –≤—ã—Ä—É—á–∫–µ</h3><p>–ö–∞–∂–¥–∞—è –∏–≥—Ä–∞ ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–∫—É–ø–∫–∞ –Ω–∞–ø–∏—Ç–∫–∞. –ü—Ä–∏ —Å—Ä–µ–¥–Ω–µ–π –∑–∞–≥—Ä—É–∑–∫–µ 30-60 –∏–≥—Ä –≤ –¥–µ–Ω—å ‚Äî –æ—â—É—Ç–∏–º—ã–π —Ä–æ—Å—Ç. –¢–æ—á–Ω—ã–π —Ä–∞—Å—á—ë—Ç ‚Äî –≤ –±–ª–æ–∫–µ —ç–∫–æ–Ω–æ–º–∏–∫–∏ –Ω–∏–∂–µ.</p></div>
        <div class="b-card reveal"><div class="b-icon">üì¶</div><h3>–ú—ã –ø—Ä–∏–≤–æ–∑–∏–º –≤—Å—ë</h3><p>–ü—Ä–æ–µ–∫—Ç–æ—Ä, –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ, —Å–æ—Ñ—Ç ‚Äî –≤—Å—ë –Ω–∞—à–µ. –û—Ç –≤–∞—Å ‚Äî —Ç–æ–ª—å–∫–æ Wi-Fi.</p></div>
        <div class="b-card reveal"><div class="b-icon">üì£</div><h3>–í–∏—Ä—É—Å–Ω—ã–π –º–∞—Ä–∫–µ—Ç–∏–Ω–≥</h3><p>¬´–Ø –∏–≥—Ä–∞–ª –≤ Flappy Beer –∏ –≤—ã–∏–≥—Ä–∞–ª –ø–∏–≤–æ!¬ª ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞ –æ—Ç –≥–æ—Å—Ç–µ–π.</p></div>
        <div class="b-card reveal"><div class="b-icon">ü§ù</div><h3>–ì–∏–±–∫–∏–µ —É—Å–ª–æ–≤–∏—è</h3><p>–ü—Ä–æ—Ü–µ–Ω—Ç, —Å–ª–æ–∂–Ω–æ—Å—Ç—å, –º–æ–¥–µ–ª—å –æ–ø–ª–∞—Ç—ã ‚Äî –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–æ–¥ –≤–∞—à—É —ç–∫–æ–Ω–æ–º–∏–∫—É.</p></div>
        <div class="b-card reveal"><div class="b-icon">üõ°Ô∏è</div><h3>–ë–µ–∑ –≤–ª–æ–∂–µ–Ω–∏–π</h3><p>–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ. –ù–µ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å ‚Äî –ø—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏—Ç–µ, –∑–∞–±–µ—Ä—ë–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ.</p></div>
    </div>
</div></section>

<!-- ECONOMICS ‚Äî NEW MODEL: 100‚ÇΩ PER GAME -->
<section class="eco-section" id="eco"><div class="s-inner">
    <div class="s-label reveal" style="text-align:center;">// HIGH SCORE</div>
    <h2 class="s-title reveal" style="text-align:center;">–≠–ö–û–ù–û–ú–ò–ö–ê ‚Äî –ü–†–û–ó–†–ê–ß–ù–û</h2>
    <p class="s-desc reveal" style="text-align:center;margin:0 auto;">–ì–æ—Å—Ç—å –ø–ª–∞—Ç–∏—Ç 100‚ÇΩ –∑–∞ –∏–≥—Ä—É. –í—ã–∏–≥—Ä–∞–ª ‚Äî –ø–æ–ª—É—á–∞–µ—Ç –ø–∏–≤–æ. –ü—Ä–æ–∏–≥—Ä–∞–ª ‚Äî –ø–ª–∞—Ç–∏—Ç –µ—â—ë.</p>
    <div class="eco-grid">
        <div class="eco-calc reveal">
            <div class="eco-calc-title">‚ñ∫ –¶–ò–ö–õ –û–î–ù–û–ô –ò–ì–†–´: 100‚ÇΩ</div>
            <div class="eco-row"><div class="eco-key"><span class="em">üéÆ</span> –ì–æ—Å—Ç—å –ø–ª–∞—Ç–∏—Ç –∑–∞ –∏–≥—Ä—É</div><div class="eco-val" style="color:var(--yw)">100 ‚ÇΩ</div></div>
            <div class="eco-row"><div class="eco-key"><span class="em">üéØ</span> –®–∞–Ω—Å –≤—ã–∏–≥—Ä—ã—à–∞ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π)</div><div class="eco-val">20%</div></div>
            <div class="eco-row"><div class="eco-key"><span class="em">üç∫</span> –ü—Ä–∏–∑ ‚Äî –ø–∏–≤–æ 0.5–ª (—Å–µ–±–µ—Å—Ç. –±–∞—Ä–∞)</div><div class="eco-val dim">‚àí20 ‚ÇΩ/–∏–≥—Ä–∞</div></div>
            <div class="eco-row"><div class="eco-key"><span class="em">üìä</span> –ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å —Å 1 –∏–≥—Ä—ã</div><div class="eco-val hl">80 ‚ÇΩ</div></div>
            <div class="eco-row"><div class="eco-key"><span class="em">ü§ù</span> –ö–æ–º–∏—Å—Å–∏—è BARPLAY (30%)</div><div class="eco-val dim">‚àí24 ‚ÇΩ</div></div>
            <div class="eco-row total"><div class="eco-key"><span class="em">üí∞</span> <strong>–ò–¢–û–ì–û –ë–ê–†–£ —Å –∫–∞–∂–¥–æ–π –∏–≥—Ä—ã</strong></div><div><div class="eco-val big">56 ‚ÇΩ</div></div></div>
            <div style="height:1px;background:rgba(255,255,255,.04);margin:1rem 0;"></div>
            <div class="eco-row"><div class="eco-key"><span class="em">üìÖ</span> –ò–≥—Ä –≤ –º–µ—Å—è—Ü (30 –±—É–¥–Ω–∏ + 60 –≤—ã—Ö–æ–¥–Ω—ã–µ)</div><div class="eco-val">~1 140</div></div>
            <div class="eco-row"><div class="eco-key"><span class="em">üéÅ</span> –ò–∑ –Ω–∏—Ö –≤—ã–∏–≥—Ä—ã—à–µ–π</div><div class="eco-val dim">~228 —à—Ç</div></div>
            <div class="eco-row total"><div class="eco-key"><span class="em">üèÜ</span> <strong>–î–æ—Ö–æ–¥ –±–∞—Ä–∞ –≤ –º–µ—Å—è—Ü</strong></div><div><div class="eco-val big">+63 840 ‚ÇΩ</div><div class="eco-val sub">‚âà 741 720 ‚ÇΩ –∑–∞ –≥–æ–¥</div></div></div>
            <div class="eco-note"><strong>‚ö° –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–∏–±–∫–∏–µ:</strong> —Ü–µ–Ω–∞ –∏–≥—Ä—ã, —à–∞–Ω—Å –≤—ã–∏–≥—Ä—ã—à–∞ (15-30%), –ø—Ä–∏–∑ ‚Äî –ø–æ–¥–±–∏—Ä–∞–µ–º –ø–æ–¥ –≤–∞—à –±–∞—Ä. –¢–æ—á–Ω—ã–π —Ä–∞—Å—á—ë—Ç –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π –¥–µ–º–æ-–≤—Å—Ç—Ä–µ—á–µ.</div>
        </div>
        <div class="eco-side">
            <div class="eco-hi reveal"><div class="eco-hi-num">100‚ÇΩ</div><div class="eco-hi-text"><strong>–¶–µ–Ω–∞ –æ–¥–Ω–æ–π –∏–≥—Ä—ã</strong>–û—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç, –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞–ø–∏—Ç–∫–æ–≤</div></div>
            <div class="eco-hi reveal"><div class="eco-hi-num">56‚ÇΩ</div><div class="eco-hi-text"><strong>–ß–∏—Å—Ç—ã–º–∏ –±–∞—Ä—É —Å –∫–∞–∂–¥–æ–π –∏–≥—Ä—ã</strong>–ü–æ—Å–ª–µ –ø—Ä–∏–∑–æ–≤ –∏ –∫–æ–º–∏—Å—Å–∏–∏ BARPLAY</div></div>
            <div class="eco-hi reveal"><div class="eco-hi-num">1 140</div><div class="eco-hi-text"><strong>–ò–≥—Ä –≤ —Å—Ä–µ–¥–Ω–µ–º –±–∞—Ä–µ / –º–µ—Å</strong>30 –≤ –±—É–¥–Ω–∏ + 60 –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ –≤ –¥–µ–Ω—å</div></div>
            <div class="eco-hi reveal"><div class="eco-hi-num">0 ‚ÇΩ</div><div class="eco-hi-text"><strong>–í–ª–æ–∂–µ–Ω–∏–π –æ—Ç –±–∞—Ä–∞</strong>–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–µ–∫—Ç–æ—Ä ‚Äî –Ω–∞—à–∏</div></div>
        </div>
    </div>
</div></section>

<section><div class="s-inner">
    <div class="s-label reveal" style="text-align:center;">// LEADERBOARD</div><h2 class="s-title reveal" style="text-align:center;">–ß–¢–û –ì–û–í–û–†–Ø–¢ –í–õ–ê–î–ï–õ–¨–¶–´</h2>
    <div class="proof-grid">
        <div class="proof-card reveal"><div class="proof-stars">‚òÖ ‚òÖ ‚òÖ ‚òÖ ‚òÖ</div><p class="proof-text">¬´–ì–æ—Å—Ç–∏ –∑–∞–ª–∏–ø–∞—é—Ç. –í –ø—è—Ç–Ω–∏—Ü—É –æ—á–µ—Ä–µ–¥—å ‚Äî –∫–∞–∂–¥—ã–π –±–µ—Ä—ë—Ç –Ω–∞–ø–∏—Ç–æ–∫ —á—Ç–æ–±—ã —Å—ã–≥—Ä–∞—Ç—å. –í—ã—Ä—É—á–∫–∞ –∑–∞ –ø–µ—Ä–≤—ã–π –º–µ—Å—è—Ü –≤—ã—Ä–æ—Å–ª–∞ –Ω–∞ 12%.¬ª</p><div class="proof-who"><div class="proof-ava">AK</div><div><div class="proof-name">–ê–ª–µ–∫—Å–µ–π –ö.</div><div class="proof-role">–ö—Ä–∞—Ñ—Ç–æ–≤—ã–π –±–∞—Ä, –ú–æ—Å–∫–≤–∞</div></div></div></div>
        <div class="proof-card reveal"><div class="proof-stars">‚òÖ ‚òÖ ‚òÖ ‚òÖ ‚òÖ</div><p class="proof-text">¬´–ü—Ä–∏–≤–µ–∑–ª–∏ –≤—Å—ë —Å–∞–º–∏, –ø–æ—Å—Ç–∞–≤–∏–ª–∏ –∑–∞ –ø–æ–ª–¥–Ω—è. –ë–∞—Ä–º–µ–Ω—ã —Ä–∞–∑–æ–±—Ä–∞–ª–∏—Å—å –∑–∞ 10 –º–∏–Ω—É—Ç. –¢–µ–ø–µ—Ä—å –Ω–∞—à–∞ —Ñ–∏—à–∫–∞.¬ª</p><div class="proof-who"><div class="proof-ava">M–î</div><div><div class="proof-name">–ú–∞—Ä–∏–Ω–∞ –î.</div><div class="proof-role">–ü–∞–±, –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥</div></div></div></div>
        <div class="proof-card reveal"><div class="proof-stars">‚òÖ ‚òÖ ‚òÖ ‚òÖ ‚òÖ</div><p class="proof-text">¬´–ù—É–ª–µ–≤–æ–π —Ä–∏—Å–∫ —Ä–µ—à–∏–ª. –ü–æ–ø—Ä–æ–±–æ–≤–∞–ª–∏ ‚Äî —Å—Ç–∞–≤–∏–º –≤–æ –≤—Å–µ —Ç–æ—á–∫–∏. –ì–æ—Å—Ç–∏ –ø—Ä–∏–≤–æ–¥—è—Ç –¥—Ä—É–∑–µ–π.¬ª</p><div class="proof-who"><div class="proof-ava">–îB</div><div><div class="proof-name">–î–º–∏—Ç—Ä–∏–π –í.</div><div class="proof-role">–°–µ—Ç—å –±–∞—Ä–æ–≤, –ö–∞–∑–∞–Ω—å</div></div></div></div>
    </div>
</div></section>

<section class="gp-section" id="start"><div class="s-inner">
    <div class="s-label reveal" style="text-align:center;">// GAME PLAN</div><h2 class="s-title reveal" style="text-align:center;">–ö–ê–ö –ù–ê–ß–ê–¢–¨ –ò–ì–†–ê–¢–¨</h2><p class="s-desc reveal" style="text-align:center;margin:0 auto;">–û—Ç –∑–∞—è–≤–∫–∏ –¥–æ –ø–µ—Ä–≤—ã—Ö –∏–≥—Ä ‚Äî 1 —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å.</p>
    <div class="dk-wrapper reveal">
        <canvas id="dkCanvas"></canvas>
    </div>
</div></section>

<section id="faq"><div class="s-inner">
    <div class="s-label reveal" style="text-align:center;">// HELP MENU</div><h2 class="s-title reveal" style="text-align:center;">–ß–ê–°–¢–´–ï –í–û–ü–†–û–°–´</h2>
    <div class="faq-list">
        <div class="faq-item reveal"><button class="faq-q">–ß—Ç–æ –Ω—É–∂–Ω–æ –æ—Ç –±–∞—Ä–∞? <span class="faq-icon">+</span></button><div class="faq-a"><p>–¢–æ–ª—å–∫–æ Wi-Fi. –ü—Ä–æ–µ–∫—Ç–æ—Ä, –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ, —Å–æ—Ñ—Ç ‚Äî –≤—Å—ë –ø—Ä–∏–≤–æ–∑–∏–º –º—ã.</p></div></div>
        <div class="faq-item reveal"><button class="faq-q">–ö–∞–∫–∏–µ —É—Å–ª–æ–≤–∏—è –∏ —Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç? <span class="faq-icon">+</span></button><div class="faq-a"><p>–£—Å–ª–æ–≤–∏—è –≥–∏–±–∫–∏–µ ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç, —Å–ª–æ–∂–Ω–æ—Å—Ç—å, –º–æ–¥–µ–ª—å –æ–ø–ª–∞—Ç—ã –ø–æ–¥–±–∏—Ä–∞–µ–º –ø–æ–¥ –≤–∞—Å. –°—Ç–∞—Ä—Ç–æ–≤—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π –Ω–µ—Ç.</p></div></div>
        <div class="faq-item reveal"><button class="faq-q">–°–ª–æ–∂–Ω–æ –ª–∏ –æ–±—É—á–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª? <span class="faq-icon">+</span></button><div class="faq-a"><p>10 –º–∏–Ω—É—Ç. –û–¥–Ω–æ –Ω–∞–∂–∞—Ç–∏–µ ‚Äî –≥–æ—Å—Ç—å –∏–≥—Ä–∞–µ—Ç. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–∞.</p></div></div>
        <div class="faq-item reveal"><button class="faq-q">–ï—Å–ª–∏ –≥–æ—Å—Ç—è–º –Ω–µ –ø–æ–Ω—Ä–∞–≤–∏—Ç—Å—è? <span class="faq-icon">+</span></button><div class="faq-a"><p>–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ. –ù–µ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å ‚Äî –ø—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏—Ç–µ, –∑–∞–±–µ—Ä—ë–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ. –í—ã –Ω–∏—á–µ–≥–æ –Ω–µ –ø–ª–∞—Ç–∏—Ç–µ.</p></div></div>
        <div class="faq-item reveal"><button class="faq-q">–ù—É–∂–Ω–æ –ª–∏ –ø–æ–∫—É–ø–∞—Ç—å –ø—Ä–æ–µ–∫—Ç–æ—Ä? <span class="faq-icon">+</span></button><div class="faq-a"><p>–ù–µ—Ç. –ú—ã –ø—Ä–∏–≤–æ–∑–∏–º –≤—Å—ë –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ. –û—Ç –≤–∞—Å ‚Äî —Ç–æ–ª—å–∫–æ Wi-Fi.</p></div></div>
        <div class="faq-item reveal"><button class="faq-q">–ö–∞–∫–∞—è –∏–º–µ–Ω–Ω–æ –∏–≥—Ä–∞? <span class="faq-icon">+</span></button><div class="faq-a"><p>Flappy Beer ‚Äî –∞—Ä–∫–∞–¥–∞ –Ω–∞ –æ–¥–Ω—É –∫–Ω–æ–ø–∫—É. –†–∞—É–Ω–¥ 15-30 —Å–µ–∫—É–Ω–¥. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–µ–º–æ –Ω–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ. –†–µ–≥—É–ª—è—Ä–Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ —Ä–µ–∂–∏–º—ã.</p></div></div>
    </div>
</div></section>

<div class="pixel-divider" style="padding-top:3rem;"><span style="background:var(--cy)"></span><span style="background:var(--pk)"></span><span style="background:var(--yw)"></span><span style="background:var(--gn)"></span></div>

<section class="cta-section"><div class="cta-bg"></div><div class="s-inner">
    <h2 class="s-title reveal" style="text-align:center;">READY PLAYER ONE?</h2>
    <p class="s-desc reveal" style="text-align:center;margin:0 auto 2rem;">–û—Å—Ç–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É ‚Äî –ø–æ–∫–∞–∂–µ–º –¥–µ–º–æ –∏ —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –ø—Ä–∏–±—ã–ª—å –ø–æ–¥ –≤–∞—à –±–∞—Ä.</p>
    <div class="reveal" style="text-align:center;"><a href="#" class="btn-play" onclick="openM();return false;" style="font-size:.75rem;padding:1.1rem 2.5rem;">‚ñ∂ –ù–ê–ß–ê–¢–¨ –ò–ì–†–£</a></div>
</div></section>

<footer><p>¬© 2026 BARPLAY ‚Äî GAME OVER? NEVER. ‚òÖ</p></footer>

<div class="overlay" id="ov"><div class="modal">
    <button class="modal-x" onclick="closeM()">‚úï</button>
    <div class="form-fields" id="ff">
        <h2>‚ñ∫ INSERT COIN</h2><p class="ms">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É ‚Äî —Å–≤—è–∂–µ–º—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 2 —á–∞—Å–æ–≤.</p>
        <!-- Honeypot ‚Äî hidden from humans, catches bots -->
        <div style="position:absolute;left:-9999px;"><input type="text" name="website" id="fHoney" tabindex="-1" autocomplete="off"></div>
        <div class="fg"><label>–í–∞—à–µ –∏–º—è</label><input type="text" placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?" id="fN" required></div>
        <div class="fg"><label>–¢–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ Telegram</label><input type="text" placeholder="+7 (___) ___-__-__" id="fP" required></div>
        <div class="fg"><label>–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è</label><input type="text" placeholder="–ë–∞—Ä / –ø–∞–± / —Ä–µ—Å—Ç–æ—Ä–∞–Ω" id="fB"></div>
        <div class="fg"><label>–ì–æ—Ä–æ–¥</label><input type="text" placeholder="–ú–æ—Å–∫–≤–∞" id="fC"></div>
        <div class="fg"><label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label><textarea placeholder="–õ—é–±—ã–µ –≤–æ–ø—Ä–æ—Å—ã..." id="fCo"></textarea></div>
        <button class="btn-play" style="width:100%;justify-content:center;" id="fBtn" onclick="submitF()">‚ñ∂ –û–¢–ü–†–ê–í–ò–¢–¨ –ó–ê–Ø–í–ö–£</button>
    </div>
    <div class="form-ok" id="fOk"><div style="font-size:2.5rem;margin-bottom:.75rem;">üéÆ</div><h3>GAME ON!</h3><p>–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞. –°–≤—è–∂–µ–º—Å—è –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.</p></div>
</div></div>

<script>
window.addEventListener('scroll',()=>{document.getElementById('nav').classList.toggle('sc',scrollY>60);document.getElementById('sBar').style.width=(scrollY/(document.body.scrollHeight-innerHeight))*100+'%';});
function togMenu(){document.getElementById('burger').classList.toggle('on');document.getElementById('mm').classList.toggle('on');document.body.style.overflow=document.getElementById('mm').classList.contains('on')?'hidden':'';}
const obs=new IntersectionObserver(e=>{e.forEach(x=>{if(x.isIntersecting)x.target.classList.add('vis');});},{threshold:.1,rootMargin:'0px 0px -40px 0px'});
document.querySelectorAll('.reveal').forEach(el=>obs.observe(el));
document.querySelectorAll('.faq-q').forEach(b=>{b.addEventListener('click',()=>{const i=b.parentElement,w=i.classList.contains('on');document.querySelectorAll('.faq-item').forEach(x=>x.classList.remove('on'));if(!w)i.classList.add('on');});});
function openM(){document.getElementById('ov').classList.add('on');document.body.style.overflow='hidden';}
function closeM(){document.getElementById('ov').classList.remove('on');document.body.style.overflow='';}
document.getElementById('ov').addEventListener('click',e=>{if(e.target===e.currentTarget)closeM();});
document.addEventListener('keydown',e=>{if(e.key==='Escape')closeM();});
function submitF(){
    const n=document.getElementById('fN').value.trim();
    const p=document.getElementById('fP').value.trim();
    if(!n||!p){alert('–£–∫–∞–∂–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω');return;}
    const btn=document.getElementById('fBtn');
    btn.textContent='‚è≥ –û–¢–ü–†–ê–í–ö–ê...';btn.disabled=true;
    fetch('/api/send',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({
            name:n,
            phone:p,
            bar:document.getElementById('fB').value.trim(),
            city:document.getElementById('fC').value.trim(),
            comment:document.getElementById('fCo').value.trim(),
            website:document.getElementById('fHoney').value
        })
    })
    .then(r=>r.json()).then(d=>{
        if(d.ok){
            document.getElementById('ff').classList.add('off');
            document.getElementById('fOk').classList.add('on');
        }else{
            alert('–û—à–∏–±–∫–∞: '+(d.error||'–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ'));
            btn.textContent='‚ñ∂ –û–¢–ü–†–ê–í–ò–¢–¨ –ó–ê–Ø–í–ö–£';btn.disabled=false;
        }
    }).catch(()=>{
        alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –≤ Telegram.');
        btn.textContent='‚ñ∂ –û–¢–ü–†–ê–í–ò–¢–¨ –ó–ê–Ø–í–ö–£';btn.disabled=false;
    });
}
const rain=document.getElementById('pxRain');
if(rain){const c=['#FF2D6B','#00FFF7','#FFE033','#39FF14','#B026FF'];for(let i=0;i<20;i++){const d=document.createElement('div');d.className='pixel-drop';d.style.left=Math.random()*100+'%';d.style.background=c[~~(Math.random()*c.length)];d.style.animationDuration=(5+Math.random()*10)+'s';d.style.animationDelay=Math.random()*8+'s';d.style.opacity=.3+Math.random()*.4;rain.appendChild(d);}}

// ============= FLAPPY BEER ‚Äî ORIGINAL FB PHYSICS =============
// Based on original Flappy Bird values (288√ó512 canvas @60fps):
//   gravity = 0.5 px/frame¬≤, flap = -8 px/frame, pipe_speed = 2 px/frame
//   pipe_gap = 90px, bird = 34√ó24px
// Converted to normalised 0..1 coords for adaptive canvas.
// State machine: idle ‚Üí ready ‚Üí play ‚Üí dead / won (like MMarQs)
// Fixed-timestep loop: physics always run at 60 logical fps.

const canvas = document.getElementById('gameCanvas');
if (canvas) {
const ctx = canvas.getContext('2d');
let CW, CH;

function resize() {
    const r = canvas.parentElement.getBoundingClientRect();
    CW = Math.floor(r.width); CH = Math.floor(r.height);
    canvas.width = CW; canvas.height = CH;
}
resize();
window.addEventListener('resize', resize);

// ---------- constants (original values ‚Üí normalised) ----------
// Y-axis normalised to canvas height (512px original)
// X-axis normalised to canvas width  (288px original)
const GRAVITY     =  0.5  / 512;   // 0.000977 per tick
const FLAP_VEL    = -8    / 512;   // ‚àí0.01563 per tick
const MAX_FALL    =  10   / 512;   // terminal velocity
const BIRD_W      =  24   / 288;   // ~0.083
const BIRD_H      =  34   / 512;   // ~0.066  (we use square-ish mug ‚âà 0.055)
const BIRD_X      =  0.15;
const BIRD_SIZE   =  0.055;        // visual size of beer mug
const PIPE_W      =  52   / 288;   // ~0.18 (narrowed for playability)
const PIPE_GAP_Y  =  100  / 512;   // ~0.195 (slightly wider than original 90px for landscape)
const PIPE_SPEED  =  2    / 288;   // ~0.00694 per tick
const PIPE_SPAWN  =  180  / 288;   // horizontal spacing between pipes ‚âà 0.625
const GROUND_H    =  0.025;
const TARGET_FPS  =  60;
const TICK_MS     =  1000 / TARGET_FPS;

// make pipe visually narrower so landscape doesn't feel cramped
const G_PIPE_W    = 0.12;
const G_PIPE_GAP  = 0.24;          // slightly wider gap for wider hands
const G_PIPE_SPD  = 0.005;         // slightly slower for wide screen

let bird, pipes, score, best = 0, state, stars, ticks;
let deathByHand = false;
let lastTime = 0, accumulator = 0;

// ---------- init ----------
function init() {
    bird  = { y: 0.40, vy: 0, angle: 0 };
    pipes = [];
    score = 0;
    state = 'idle';       // idle ‚Üí ready ‚Üí play ‚Üí dead / won
    ticks = 0;
    deathByHand = false;
    stars = Array.from({ length: 40 }, () => ({
        x: Math.random(), y: Math.random(), s: 0.5 + Math.random()
    }));
    document.getElementById('hudScore').textContent = 'SCORE: 0';
}
init();

// ---------- pipe factory ----------
function addPipe() {
    const minTop = 0.08;
    const maxTop = 0.72 - G_PIPE_GAP;
    const topEnd = minTop + Math.random() * (maxTop - minTop);
    pipes.push({
        x: 1.15,                     // spawn just off-screen right
        topEnd: topEnd,
        botStart: topEnd + G_PIPE_GAP,
        scored: false
    });
}

// ---------- input ----------
function doFlap() {
    if (state === 'idle') {
        state = 'ready';              // show "Get Ready" ‚Äì bird bobs
    } else if (state === 'ready') {
        state = 'play';               // first real flap ‚Üí start physics
        bird.vy = FLAP_VEL;
        ticks = 0;
        addPipe();                    // first pipe
    } else if (state === 'play') {
        bird.vy = FLAP_VEL;          // regular flap
    } else if (state === 'dead') {
        // Instant restart ‚Äî skip idle/ready, go straight to playing
        init();
        state = 'play';
        bird.vy = FLAP_VEL;
        ticks = 0;
        addPipe();
    }
}
window.flap = doFlap;

document.addEventListener('keydown', e => {
    if (e.key === ' ' || e.key === 'ArrowUp') { e.preventDefault(); doFlap(); }
});
canvas.addEventListener('click', e => { e.preventDefault(); doFlap(); });
canvas.addEventListener('touchstart', e => { e.preventDefault(); doFlap(); }, { passive: false });

// ---------- fixed-step physics ----------
function physicsTick() {
    if (state === 'ready') {
        // Bird bobs gently ‚Äì no gravity, no pipes
        bird.y = 0.40 + Math.sin(ticks * 0.05) * 0.018;
        bird.angle = 0;
        ticks++;
        return;
    }
    if (state !== 'play') return;

    // Gravity (original: vy += 0.5 each frame)
    bird.vy += GRAVITY;
    if (bird.vy > MAX_FALL) bird.vy = MAX_FALL;
    bird.y += bird.vy;

    // Bird rotation (like MMarQs / original):
    //   rising ‚Üí tilt up (‚àí25¬∞)  |  falling ‚Üí tilt down toward +90¬∞
    if (bird.vy < 0) {
        bird.angle = -0.44;                       // ‚âà ‚àí25¬∞ in radians
    } else {
        // gradually rotate down
        bird.angle += 0.035;                       // ~2¬∞ per frame
        if (bird.angle > 1.57) bird.angle = 1.57;  // cap at 90¬∞
    }

    // Pipe spawning
    const spawnInterval = Math.round(PIPE_SPAWN / G_PIPE_SPD);
    if (ticks > 0 && ticks % spawnInterval === 0) addPipe();

    // Hitbox (slightly forgiving)
    const bx1 = BIRD_X + BIRD_SIZE * 0.1;
    const bx2 = BIRD_X + BIRD_SIZE * 0.65;
    const by1 = bird.y + BIRD_SIZE * 0.05;
    const by2 = bird.y + BIRD_SIZE * 0.9;

    for (let i = 0; i < pipes.length; i++) {
        const p = pipes[i];
        p.x -= G_PIPE_SPD;

        // Score
        if (!p.scored && p.x + G_PIPE_W < BIRD_X) {
            p.scored = true;
            score++;
            document.getElementById('hudScore').textContent = 'SCORE: ' + score;
            if (score >= 10) {
                state = 'won';
                best = Math.max(best, score);
                document.getElementById('hudBest').textContent = 'BEST: ' + best;
                document.getElementById('winOverlay').classList.add('on');
                return;
            }
        }

        // Collision with hand
        if (bx2 > p.x && bx1 < p.x + G_PIPE_W) {
            if (by1 < p.topEnd || by2 > p.botStart) {
                die('hand'); return;
            }
        }
    }
    pipes = pipes.filter(p => p.x > -G_PIPE_W - 0.05);

    // Floor / ceiling
    if (bird.y < -BIRD_SIZE * 0.3 || bird.y + BIRD_SIZE > 1 - GROUND_H) {
        die('fall'); return;
    }

    ticks++;
}

function die(reason) {
    state = 'dead';
    deathByHand = (reason === 'hand');
    best = Math.max(best, score);
    document.getElementById('hudBest').textContent = 'BEST: ' + best;
}

// ---------- drawing helpers ----------
function px(v) { return v * CW; }
function py(v) { return v * CH; }
function drawRect(vx, vy, vw, vh, col) {
    ctx.fillStyle = col;
    ctx.fillRect(px(vx), py(vy), px(vw), py(vh));
}

function drawBeer(bx, by, bs, angle) {
    const cx = px(bx + bs * 0.4), cy = py(by + bs * 0.5);
    ctx.save();
    ctx.translate(cx, cy);
    ctx.rotate(angle || 0);
    ctx.translate(-cx, -cy);
    // Mug body
    drawRect(bx, by, bs * 0.75, bs, '#FFE033');
    drawRect(bx + bs * 0.05, by, bs * 0.65, bs * 0.15, '#FFF5AA');
    // Handle
    drawRect(bx + bs * 0.75, by + bs * 0.15, bs * 0.25, bs * 0.12, '#cca020');
    drawRect(bx + bs * 0.88, by + bs * 0.27, bs * 0.12, bs * 0.35, '#cca020');
    drawRect(bx + bs * 0.75, by + bs * 0.62, bs * 0.25, bs * 0.12, '#cca020');
    // Beer inside
    drawRect(bx + bs * 0.1, by + bs * 0.2, bs * 0.55, bs * 0.7, '#dd9500');
    // Foam
    drawRect(bx, by - bs * 0.15, bs * 0.75, bs * 0.2, '#fff');
    drawRect(bx + bs * 0.1, by - bs * 0.28, bs * 0.4, bs * 0.15, '#fff');
    ctx.restore();
}

// ---------- render (runs at screen refresh rate) ----------
function render(now) {
    requestAnimationFrame(render);
    if (!lastTime) { lastTime = now; return; }

    // Fixed timestep accumulator ‚Üí physics always 60 "ticks" per second
    const dt = Math.min(now - lastTime, 50);   // cap spike at 50ms
    lastTime = now;
    accumulator += dt;
    while (accumulator >= TICK_MS) {
        physicsTick();
        accumulator -= TICK_MS;
    }

    // --- draw ---
    ctx.fillStyle = '#05051a';
    ctx.fillRect(0, 0, CW, CH);

    // Stars
    stars.forEach(s => {
        s.y += s.s * 0.0003;
        if (s.y > 1) { s.y = 0; s.x = Math.random(); }
        drawRect(s.x, s.y, 0.003, 0.004, `rgba(255,255,255,${0.15 + s.s * 0.2})`);
    });

    // Ground
    drawRect(0, 1 - GROUND_H, 1, GROUND_H, '#1a1530');
    drawRect(0, 1 - GROUND_H, 1, 0.003, '#2a2540');

    // Scrolling ground texture
    if (state === 'play' || state === 'ready') {
        const gOff = (ticks * 1.5) % 20;
        for (let i = 0; i < CW / 10 + 2; i++) {
            ctx.fillStyle = 'rgba(255,255,255,.03)';
            ctx.fillRect(i * 10 - gOff, py(1 - GROUND_H + 0.008), 5, py(0.003));
        }
    }

    // Hands (replacing pipes) ‚Äî reaching for the beer
    const handTime = Date.now() / 1000;
    pipes.forEach(p => {
        const armColor = '#D2915A';
        const armDark = '#B07040';
        const sleeve = '#1a1a3a';
        const grab = Math.sin(handTime * 3 + p.x * 20) * 0.008; // grabbing animation
        
        // === TOP HAND (reaching down) ===
        // Arm/sleeve from top
        drawRect(p.x + 0.01, 0, G_PIPE_W - 0.02, p.topEnd - 0.06, sleeve);
        // Rolled-up sleeve cuff
        drawRect(p.x, p.topEnd - 0.07, G_PIPE_W, 0.025, '#2a2a5a');
        // Forearm (skin)
        drawRect(p.x + 0.005, p.topEnd - 0.045, G_PIPE_W - 0.01, 0.035, armColor);
        // Hand ‚Äî open palm reaching down
        const topHandY = p.topEnd - 0.015 + grab;
        // Palm
        drawRect(p.x - 0.008, topHandY, G_PIPE_W + 0.016, 0.025, armColor);
        // Fingers (4 fingers reaching down)
        for(let f = 0; f < 4; f++){
            const fx = p.x - 0.005 + f * (G_PIPE_W + 0.01) / 4;
            const fLen = 0.018 + Math.sin(handTime*4 + f*1.5) * 0.004;
            drawRect(fx, topHandY + 0.022, 0.018, fLen, armColor);
            // Fingertip darker
            drawRect(fx + 0.003, topHandY + 0.022 + fLen - 0.005, 0.012, 0.005, armDark);
        }
        // Thumb (on side)
        drawRect(p.x + G_PIPE_W + 0.005, topHandY + 0.005, 0.015, 0.018 + grab, armColor);
        
        // === BOTTOM HAND (reaching up) ===
        // Arm/sleeve from bottom
        drawRect(p.x + 0.01, p.botStart + 0.06, G_PIPE_W - 0.02, 1 - p.botStart - GROUND_H - 0.06, sleeve);
        // Sleeve cuff
        drawRect(p.x, p.botStart + 0.04, G_PIPE_W, 0.025, '#2a2a5a');
        // Forearm (skin)
        drawRect(p.x + 0.005, p.botStart + 0.01, G_PIPE_W - 0.01, 0.035, armColor);
        // Hand ‚Äî open palm reaching up
        const botHandY = p.botStart - 0.01 - grab;
        // Palm
        drawRect(p.x - 0.008, botHandY, G_PIPE_W + 0.016, 0.025, armColor);
        // Fingers (4 fingers reaching up)
        for(let f = 0; f < 4; f++){
            const fx = p.x - 0.005 + f * (G_PIPE_W + 0.01) / 4;
            const fLen = 0.018 + Math.sin(handTime*4 + f*1.5 + 2) * 0.004;
            drawRect(fx, botHandY - fLen, 0.018, fLen, armColor);
            drawRect(fx + 0.003, botHandY - fLen, 0.012, 0.005, armDark);
        }
        // Thumb
        drawRect(p.x + G_PIPE_W + 0.005, botHandY + 0.002, 0.015, 0.018 + grab, armColor);
    });

    // Bird (always visible except after death)
    if (state !== 'dead') {
        drawBeer(BIRD_X, bird.y, BIRD_SIZE, bird.angle);
    }

    // ---------- UI overlays ----------
    ctx.textAlign = 'center';
    const fz = Math.max(10, CW * 0.04);

    if (state === 'idle') {
        ctx.fillStyle = '#FFE033';
        ctx.font = `${fz * 1.5}px "Press Start 2P",monospace`;
        ctx.fillText('FLAPPY', CW / 2, CH * 0.31);
        ctx.fillText('BEER', CW / 2, CH * 0.31 + fz * 1.8);

        ctx.fillStyle = 'rgba(255,255,255,.5)';
        ctx.font = `${fz * 0.6}px "Press Start 2P",monospace`;
        ctx.fillText('TAP TO START', CW / 2, CH * 0.56);

        // Bobbing beer icon
        const bob = Math.sin(Date.now() / 300) * CH * 0.012;
        drawBeer(0.46, 0.6 + bob / CH, 0.07, 0);
    }

    if (state === 'ready') {
        ctx.fillStyle = '#00FFF7';
        ctx.font = `${fz * 1.2}px "Press Start 2P",monospace`;
        ctx.fillText('GET READY', CW / 2, CH * 0.22);

        ctx.fillStyle = 'rgba(255,255,255,.45)';
        ctx.font = `${fz * 0.5}px "Press Start 2P",monospace`;
        ctx.fillText('TAP TO FLY', CW / 2, CH * 0.30);

        // Animated tap arrow
        const arr = Math.sin(Date.now() / 200) * CH * 0.008;
        ctx.fillStyle = 'rgba(0,255,247,.35)';
        ctx.beginPath();
        ctx.moveTo(CW / 2, CH * 0.72 + arr);
        ctx.lineTo(CW / 2 - 12, CH * 0.74 + arr);
        ctx.lineTo(CW / 2 + 12, CH * 0.74 + arr);
        ctx.fill();
    }

    if (state === 'play') {
        // Large score in centre top (like original FB)
        ctx.fillStyle = 'rgba(255,224,51,.9)';
        ctx.font = `${fz * 1.6}px "Press Start 2P",monospace`;
        ctx.lineWidth = 3;
        ctx.strokeStyle = 'rgba(0,0,0,.4)';
        ctx.strokeText('' + score, CW / 2, CH * 0.12);
        ctx.fillText('' + score, CW / 2, CH * 0.12);
    }

    if (state === 'dead') {
        ctx.fillStyle = 'rgba(0,0,0,.65)';
        ctx.fillRect(0, 0, CW, CH);

        ctx.fillStyle = '#FF2D6B';
        ctx.font = `${fz * 1.3}px "Press Start 2P",monospace`;
        ctx.fillText('GAME OVER', CW / 2, CH * 0.30);

        // Hand grabbed your beer message
        if(deathByHand){
            ctx.fillStyle = '#FF6B2D';
            ctx.font = `${fz * 0.5}px "Press Start 2P",monospace`;
            ctx.fillText('–¢–í–û–Å –ü–ò–í–û –ó–ê–ë–†–ê–õ', CW / 2, CH * 0.39);
            ctx.fillText('–î–†–£–ì–û–ô –ì–û–°–¢–¨!', CW / 2, CH * 0.44);
            // Grabbing hand emoji
            ctx.font = `${fz * 1.5}px sans-serif`;
            ctx.fillText('ü§öüç∫', CW / 2, CH * 0.53);
        }

        ctx.fillStyle = '#FFE033';
        ctx.font = `${fz * 0.7}px "Press Start 2P",monospace`;
        ctx.fillText('SCORE: ' + score, CW / 2, deathByHand ? CH * 0.62 : CH * 0.46);

        if (best > 0) {
            ctx.fillStyle = 'rgba(0,255,247,.6)';
            ctx.font = `${fz * 0.5}px "Press Start 2P",monospace`;
            ctx.fillText('BEST: ' + best, CW / 2, deathByHand ? CH * 0.69 : CH * 0.53);
        }

        ctx.fillStyle = 'rgba(255,255,255,.5)';
        ctx.font = `${fz * 0.5}px "Press Start 2P",monospace`;
        ctx.fillText('TAP TO RETRY', CW / 2, deathByHand ? CH * 0.78 : CH * 0.64);
    }

    ctx.textAlign = 'left';
}

requestAnimationFrame(render);

window.restartGame = function() {
    init();
    document.getElementById('winOverlay').classList.remove('on');
    document.getElementById('hudScore').textContent = 'SCORE: 0';
};

if ('ontouchstart' in window) document.getElementById('touchCtrl').style.display = 'flex';
}
</script>
<script>
// ==========================================
// DONKEY KONG STYLE ‚Äî GAME PLAN ROADMAP
// Classic DK visual recreation
// ==========================================
(function(){
const canvas = document.getElementById('dkCanvas');
if(!canvas) return;
const ctx = canvas.getContext('2d');

const W = 900, H = 750;
canvas.width = W; canvas.height = H;

// ---- Classic DK Color Palette ----
const PK = '#E84080';   // platform pink/magenta
const PKD = '#B03060';  // darker pink
const CY = '#00D8D8';   // cyan ladders
const CYD = '#009898';  // darker cyan
const BG = '#000000';   // pure black background
const WHT = '#FFFFFF';
const RED = '#E02020';  // Mario red
const BLUE = '#3030D0'; // Mario blue
const SKIN = '#F0A060'; // skin tone
const BROWN = '#B06020';// DK brown
const BROWND= '#804010';
const ORANGE= '#E88040';// DK lighter
const BARREL_C = '#E08830';
const BARREL_D = '#905020';
const BARREL_B = '#FFD040';
const GRN = '#39FF14';
const YLW = '#FFE033';

// ---- Platform layout (7 platforms, classic DK style) ----
const PLAT_H = 12;
const platforms = [
    {y:690, tilt: 0.012, dir: 1},   // 0: bottom ‚Äî Mario starts
    {y:585, tilt:-0.012, dir:-1},   // 1: stage 1
    {y:480, tilt: 0.012, dir: 1},   // 2: stage 2
    {y:375, tilt:-0.012, dir:-1},   // 3: stage 3
    {y:270, tilt: 0.012, dir: 1},   // 4: stage 4
    {y:170, tilt: 0,     dir: 0},   // 5: DK platform (left side only)
    {y:90,  tilt: 0,     dir: 0},   // 6: TOP ‚Äî prize platform (short, center-right)
];

// Stage labels attached to platforms
const stages = [
    {platIdx:1, label:'STAGE 1', title:'–ó–ê–Ø–í–ö–ê',     desc:'–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É', color:'#FF2D6B', icon:'üìã'},
    {platIdx:2, label:'STAGE 2', title:'–î–ï–ú–û',        desc:'–ü–æ–∫–∞–∂–µ–º —Å–∏—Å—Ç–µ–º—É',  color:'#00FFF7', icon:'üì∫'},
    {platIdx:3, label:'STAGE 3', title:'–£–°–¢–ê–ù–û–í–ö–ê',   desc:'–ü—Ä–∏–≤–æ–∑–∏–º –∑–∞ 1 –¥–µ–Ω—å', color:'#FFE033', icon:'üîß'},
    {platIdx:4, label:'–ü–û–ë–ï–î–ê!', title:'–ü–†–ò–ë–´–õ–¨',     desc:'+63 840‚ÇΩ/–º–µ—Å –±–∞—Ä—É',  color:'#39FF14', icon:'üí∞'},
];

// Ladders
const ladders = [
    {x:740, p1:0, p2:1},
    {x:160, p1:1, p2:2},
    {x:680, p1:2, p2:3},
    {x:200, p1:3, p2:4},
    {x:350, p1:4, p2:5},   // up to DK level
    {x:420, p1:5, p2:6},   // final ladder to prize!
];

// ---- Draw functions ----

function platY(pIdx, x){
    const p = platforms[pIdx];
    return p.y + (x - W/2) * p.tilt;
}

function drawPlatformRow(p, startX, endX){
    // Classic DK pink zigzag girder pattern
    for(let x = startX; x < endX; x += 8){
        const py = Math.round(p.y + (x - W/2) * p.tilt);
        // Main girder body
        ctx.fillStyle = PK;
        ctx.fillRect(x, py, 8, PLAT_H);
        // Triangle pattern (zigzag)
        ctx.fillStyle = PKD;
        const triPhase = ((x/8)|0) % 2;
        if(triPhase === 0){
            // Downward triangle
            ctx.beginPath();
            ctx.moveTo(x, py+2);
            ctx.lineTo(x+8, py+2);
            ctx.lineTo(x+4, py+PLAT_H-2);
            ctx.closePath();
            ctx.fill();
        } else {
            // Upward triangle
            ctx.beginPath();
            ctx.moveTo(x+4, py+2);
            ctx.lineTo(x, py+PLAT_H-2);
            ctx.lineTo(x+8, py+PLAT_H-2);
            ctx.closePath();
            ctx.fill();
        }
    }
}

function drawAllPlatforms(){
    for(let i=0; i<platforms.length; i++){
        if(i === 5){
            // DK platform ‚Äî left side only
            drawPlatformRow(platforms[i], 30, 470);
        } else if(i === 6){
            // Prize platform ‚Äî short, center-right (like princess platform in original)
            drawPlatformRow(platforms[i], 350, 580);
        } else {
            drawPlatformRow(platforms[i], 30, W-30);
        }
    }
}

function drawLadder(l){
    const p1 = platforms[l.p1];
    const p2 = platforms[l.p2];
    const topY = Math.round(p2.y + (l.x - W/2)*p2.tilt) + PLAT_H;
    const botY = Math.round(p1.y + (l.x - W/2)*p1.tilt);
    const h = botY - topY;
    const lw = 22;
    // Rails
    ctx.fillStyle = CYD;
    ctx.fillRect(l.x, topY, 3, h);
    ctx.fillRect(l.x+lw-3, topY, 3, h);
    // Rungs
    ctx.fillStyle = CY;
    for(let ry = topY + 8; ry < botY - 4; ry += 12){
        ctx.fillRect(l.x+3, ry, lw-6, 3);
    }
}

// ---- Donkey Kong (gorilla) ----
function drawDK(x, y, frame){
    const s = 5; // pixel scale
    ctx.save();
    ctx.translate(Math.round(x), Math.round(y));
    
    // Body (big brown mass)
    ctx.fillStyle = BROWN;
    ctx.fillRect(-s*5, -s*6, s*10, s*7);
    // Chest lighter
    ctx.fillStyle = ORANGE;
    ctx.fillRect(-s*3, -s*4, s*6, s*4);
    
    // Head
    ctx.fillStyle = BROWN;
    ctx.fillRect(-s*3, -s*10, s*6, s*4);
    // Face
    ctx.fillStyle = SKIN;
    ctx.fillRect(-s*2, -s*9, s*4, s*3);
    // Eyes
    ctx.fillStyle = WHT;
    ctx.fillRect(-s*1.5, -s*8.5, s*1, s*1);
    ctx.fillRect(s*0.5, -s*8.5, s*1, s*1);
    ctx.fillStyle = '#000';
    ctx.fillRect(-s*1.2, -s*8.2, s*0.5, s*0.5);
    ctx.fillRect(s*0.7, -s*8.2, s*0.5, s*0.5);
    // Mouth
    ctx.fillStyle = BROWND;
    ctx.fillRect(-s*1, -s*7, s*2, s*0.5);
    
    // Arms ‚Äî animate throwing
    const armSwing = Math.sin(frame * 2) * 3;
    ctx.fillStyle = BROWN;
    // Left arm
    ctx.fillRect(-s*7, -s*5 + armSwing, s*2, s*5);
    // Right arm (holding barrel area)
    ctx.fillRect(s*5, -s*5 - armSwing, s*2, s*5);
    
    // Legs
    ctx.fillStyle = BROWND;
    ctx.fillRect(-s*4, s*1, s*3, s*3);
    ctx.fillRect(s*1, s*1, s*3, s*3);
    // Feet
    ctx.fillStyle = BROWN;
    ctx.fillRect(-s*5, s*3, s*4, s*2);
    ctx.fillRect(s*1, s*3, s*4, s*2);
    
    ctx.restore();
}

// ---- Barrel stack next to DK ----
function drawBarrelStack(x, y){
    for(let i=0; i<3; i++){
        const bx = x - 15 + (i%2)*8;
        const by = y - i*20;
        drawBarrelStatic(bx, by);
    }
}

function drawBarrelStatic(x, y){
    ctx.fillStyle = BARREL_C;
    ctx.fillRect(x-12, y-9, 24, 18);
    ctx.fillStyle = BARREL_D;
    ctx.fillRect(x-12, y-9, 24, 3);
    ctx.fillRect(x-12, y+6, 24, 3);
    ctx.fillStyle = BARREL_B;
    ctx.fillRect(x-12, y-1, 24, 2);
}

// ---- Mario (red cap, blue overalls, pixel art) ----
function drawMario(x, y, climbing, walkFrame, dir){
    const s = 3;
    ctx.save();
    ctx.translate(Math.round(x), Math.round(y));
    
    if(hero.jumping && !climbing){
        // JUMP pose ‚Äî arms up, legs tucked
        // Hat
        ctx.fillStyle = RED;
        ctx.fillRect(-s*2, -s*11, s*5, s*2);
        // Head
        ctx.fillStyle = SKIN;
        ctx.fillRect(-s*2, -s*9, s*4, s*3);
        // Eye
        ctx.fillStyle = '#000';
        if(dir > 0) ctx.fillRect(s*0.5, -s*8, s*1, s*1);
        else ctx.fillRect(-s*1.5, -s*8, s*1, s*1);
        // Body
        ctx.fillStyle = RED;
        ctx.fillRect(-s*2, -s*6, s*4, s*2);
        // Overalls
        ctx.fillStyle = BLUE;
        ctx.fillRect(-s*2, -s*4, s*4, s*3);
        // Arms UP
        ctx.fillStyle = SKIN;
        ctx.fillRect(-s*3, -s*8, s*1, s*3);
        ctx.fillRect(s*2, -s*8, s*1, s*3);
        // Legs tucked
        ctx.fillStyle = BLUE;
        ctx.fillRect(-s*2, -s*1, s*1.5, s*1.5);
        ctx.fillRect(s*0.5, -s*1, s*1.5, s*1.5);
        // Boots
        ctx.fillStyle = BROWN;
        ctx.fillRect(-s*2.5, s*0.5, s*2, s*1);
        ctx.fillRect(s*0.5, s*0.5, s*2, s*1);
    } else if(climbing){
        const armOff = Math.sin(walkFrame*0.5)*2;
        // Hat
        ctx.fillStyle = RED;
        ctx.fillRect(-s*2, -s*10, s*4, s*2);
        // Head/face
        ctx.fillStyle = SKIN;
        ctx.fillRect(-s*2, -s*8, s*4, s*3);
        // Eyes
        ctx.fillStyle = '#000';
        ctx.fillRect(-s*1, -s*7, s*0.8, s*0.8);
        ctx.fillRect(s*0.2, -s*7, s*0.8, s*0.8);
        // Body (overalls)
        ctx.fillStyle = BLUE;
        ctx.fillRect(-s*2, -s*5, s*4, s*4);
        // Arms reaching
        ctx.fillStyle = RED;
        ctx.fillRect(-s*3, -s*6+armOff, s*1, s*3);
        ctx.fillRect(s*2, -s*6-armOff, s*1, s*3);
        // Legs
        ctx.fillStyle = BLUE;
        ctx.fillRect(-s*2, -s*1, s*1.5, s*2);
        ctx.fillRect(s*0.5, -s*1, s*1.5, s*2);
        // Boots
        ctx.fillStyle = BROWN;
        ctx.fillRect(-s*2, s*1, s*2, s*1);
        ctx.fillRect(s*0, s*1, s*2, s*1);
    } else {
        const legAnim = Math.sin(walkFrame*0.6)*2;
        // Hat
        ctx.fillStyle = RED;
        ctx.fillRect(-s*2, -s*10, s*5, s*2);
        if(dir > 0) ctx.fillRect(s*1, -s*10, s*2, s*1); // brim right
        else ctx.fillRect(-s*3, -s*10, s*2, s*1); // brim left
        // Head
        ctx.fillStyle = SKIN;
        ctx.fillRect(-s*2, -s*8, s*4, s*3);
        // Eye
        ctx.fillStyle = '#000';
        if(dir > 0) ctx.fillRect(s*0.5, -s*7, s*1, s*1);
        else ctx.fillRect(-s*1.5, -s*7, s*1, s*1);
        // Mustache
        ctx.fillStyle = BROWND;
        ctx.fillRect(-s*1, -s*5.5, s*2, s*0.5);
        // Body
        ctx.fillStyle = RED;
        ctx.fillRect(-s*2, -s*5, s*4, s*2);
        // Overalls
        ctx.fillStyle = BLUE;
        ctx.fillRect(-s*2, -s*3, s*4, s*3);
        // Arms
        ctx.fillStyle = SKIN;
        ctx.fillRect(-s*3, -s*5, s*1, s*3);
        ctx.fillRect(s*2, -s*5, s*1, s*3);
        // Legs
        ctx.fillStyle = BLUE;
        ctx.fillRect(-s*1.5, 0, s*1.2, s*2+legAnim);
        ctx.fillRect(s*0.3, 0, s*1.2, s*2-legAnim);
        // Boots
        ctx.fillStyle = BROWN;
        ctx.fillRect(-s*2, s*2+legAnim, s*2, s*1);
        ctx.fillRect(0, s*2-legAnim, s*2, s*1);
    }
    ctx.restore();
}

// ---- Rolling barrels ----
let barrels = [];
function drawBarrel(b){
    ctx.save();
    ctx.translate(b.x, b.y);
    ctx.rotate(b.rot);
    ctx.fillStyle = BARREL_C;
    ctx.fillRect(-13, -10, 26, 20);
    ctx.fillStyle = BARREL_D;
    ctx.fillRect(-13, -10, 26, 4);
    ctx.fillRect(-13, 6, 26, 4);
    ctx.fillStyle = BARREL_B;
    ctx.fillRect(-13, -1, 26, 3);
    ctx.restore();
}

// ---- Oil barrel fire at bottom ----
function drawOilBarrel(x, y, t){
    // Barrel
    ctx.fillStyle = '#2040C0';
    ctx.fillRect(x-14, y-20, 28, 20);
    ctx.fillStyle = '#3060E0';
    ctx.fillRect(x-14, y-20, 28, 4);
    ctx.fillStyle = WHT;
    ctx.font = '7px "Press Start 2P",monospace';
    ctx.textAlign = 'center';
    ctx.fillText('OIL', x, y-7);
    // Fire
    const flames = [
        {dx:-4, h:12+Math.sin(t*8)*4},
        {dx:0, h:16+Math.sin(t*10+1)*5},
        {dx:4, h:10+Math.sin(t*7+2)*4},
    ];
    flames.forEach(f=>{
        ctx.fillStyle = '#FF4400';
        ctx.fillRect(x+f.dx-3, y-20-f.h, 6, f.h);
        ctx.fillStyle = '#FFAA00';
        ctx.fillRect(x+f.dx-2, y-20-f.h+2, 4, f.h*0.6);
        ctx.fillStyle = '#FFEE00';
        ctx.fillRect(x+f.dx-1, y-20-f.h+4, 2, f.h*0.3);
    });
    ctx.textAlign = 'left';
}

// ---- Sparkle effects ----
let sparkles = [];
function addSparkle(x,y,col,count){
    for(let i=0;i<(count||10);i++){
        sparkles.push({x, y, vx:(Math.random()-0.5)*4, vy:-Math.random()*5-1, life:1, col:col||GRN, size:2+Math.random()*3});
    }
}

// ---- Game state ----
let hero = {x:80, y:0, stage:0, climbing:false, dir:1, frame:0, onPlatform:0, jumping:false, jumpVY:0, jumpBaseY:0};
let animTime = 0;
let started = false;
let completed = false;
let phase = 'idle'; // idle, walk_to_ladder, climb, walk_on_platform, walk_to_treasure, done
let currentLadder = 0;
let stageReached = 0; // highest stage reached
let dkThrowTimer = 0;
let pauseTimer = 0;

// ---- DK barrel throw ----
function throwBarrel(){
    const dkX = 120;
    const dkPlatY = platforms[5].y;
    // Throw towards hero's side
    const toHero = hero.x - (dkX + 40);
    barrels.push({
        x: dkX + 40,
        y: dkPlatY - 8,
        vx: toHero > 0 ? 1.8 : -1.8,
        platIdx: 5,
        rot: 0,
        falling: true,
        fallTarget: 4,
    });
}

let guaranteedJump = false; // ensure at least 1 jump happens

function updateBarrels(dt){
    // Stop throwing when animation is complete
    if(completed){
        // Let existing barrels roll off screen then remove
        for(let i=barrels.length-1; i>=0; i--){
            const b = barrels[i];
            if(!b.falling){
                b.x += b.vx * 70 * dt;
                b.rot += b.vx * 0.06;
            }
            if(b.x < -40 || b.x > W+40 || b.y > H+40) barrels.splice(i,1);
        }
        return;
    }
    
    dkThrowTimer += dt;
    
    // Guarantee one barrel crosses Mario's path on first platform
    if(started && !guaranteedJump && hero.onPlatform === 0 && phase === 'walk_to_ladder' && hero.x > 200 && barrels.length === 0){
        throwBarrel();
        dkThrowTimer = 0;
        guaranteedJump = true;
    }
    
    if(dkThrowTimer > 3.5 && barrels.length < 3){
        throwBarrel();
        dkThrowTimer = 0;
    }
    
    for(let i=barrels.length-1; i>=0; i--){
        const b = barrels[i];
        
        if(b.falling){
            // Fall down to next platform
            b.y += 150 * dt;
            b.rot += b.vx * 0.1;
            const target = platforms[b.fallTarget];
            const tpy = target.y + (b.x - W/2)*target.tilt - 10;
            if(b.y >= tpy){
                b.y = tpy;
                b.falling = false;
                b.platIdx = b.fallTarget;
                // ALWAYS roll towards the hero
                const toHero = hero.x - b.x;
                b.vx = toHero > 0 ? 1.8 : -1.8;
                b.vx *= (0.9 + Math.random()*0.3);
            }
        } else {
            // Roll on platform
            b.x += b.vx * 65 * dt;
            b.rot += b.vx * 0.1;
            const p = platforms[b.platIdx];
            b.y = p.y + (b.x - W/2)*p.tilt - 10;
            
            // Reached edge ‚Üí fall to next platform
            if(b.x < 20 || b.x > W - 20){
                if(b.platIdx > 0){
                    b.falling = true;
                    b.fallTarget = b.platIdx - 1;
                } else {
                    barrels.splice(i,1);
                    continue;
                }
            }
        }
        // Remove if off screen
        if(b.y > H + 30 || b.x < -30 || b.x > W+30) barrels.splice(i,1);
    }
}

// ---- Hero movement ----
const WALK_SPEED = 200;
const CLIMB_SPEED = 150;

// ---- Barrel jump detection ----
const JUMP_FORCE = -280;
const GRAVITY = 800;
const JUMP_DETECT_RANGE = 75; // detect faster barrels earlier
let jumpScore = 0;
let jumpScoreFlash = [];
let jumpCooldown = 0; // prevents double-jumping

function checkBarrelNearby(){
    if(hero.climbing || hero.jumping || jumpCooldown > 0) return false;
    for(let i=0; i<barrels.length; i++){
        const b = barrels[i];
        if(b.falling) continue;
        // Same platform check
        if(b.platIdx !== hero.onPlatform) continue;
        const dx = b.x - hero.x;
        const dist = Math.abs(dx);
        // Barrel approaching from ahead
        if(dist < JUMP_DETECT_RANGE && dist > 10){
            return true;
        }
    }
    return false;
}

function triggerJump(){
    if(hero.jumping || hero.climbing) return;
    hero.jumping = true;
    hero.jumpVY = JUMP_FORCE;
    hero.jumpBaseY = hero.y;
}

function updateJump(dt){
    if(!hero.jumping){
        if(jumpCooldown > 0) jumpCooldown -= dt;
        return;
    }
    hero.jumpVY += GRAVITY * dt;
    hero.y += hero.jumpVY * dt;
    // Land back on platform
    const groundY = platY(hero.onPlatform, hero.x) - 2;
    if(hero.y >= groundY && hero.jumpVY > 0){
        hero.y = groundY;
        hero.jumping = false;
        hero.jumpVY = 0;
        jumpCooldown = 0.7; // wait before next jump
        // Check if we jumped over any barrel ‚Üí score!
        barrels.forEach(b=>{
            if(b.falling) return;
            if(b.platIdx === hero.onPlatform && Math.abs(b.x - hero.x) < 50){
                jumpScore += 100;
                jumpScoreFlash.push({x:hero.x, y:hero.y - 40, life:1, val:100});
            }
        });
    }
}

function updateHero(dt){
    if(!started || completed) return;
    hero.frame += dt * 16;
    
    // Jump physics always active
    updateJump(dt);
    
    if(pauseTimer > 0){
        pauseTimer -= dt;
        // Still check for jumps while paused
        if(checkBarrelNearby()) triggerJump();
        return;
    }
    
    // Auto-jump when barrel approaches
    if(!hero.climbing && checkBarrelNearby()){
        triggerJump();
    }
    
    switch(phase){
        case 'walk_to_ladder': {
            if(currentLadder >= ladders.length){
                phase = 'walk_to_treasure';
                break;
            }
            const l = ladders[currentLadder];
            const targetX = l.x + 11;
            const dx = targetX - hero.x;
            if(Math.abs(dx) > 4){
                hero.dir = dx > 0 ? 1 : -1;
                hero.x += hero.dir * WALK_SPEED * dt;
                // Keep on platform (unless jumping)
                if(!hero.jumping) hero.y = platY(hero.onPlatform, hero.x) - 2;
            } else {
                hero.x = targetX;
                if(!hero.jumping){
                    phase = 'climb';
                    hero.climbing = true;
                }
            }
            break;
        }
        case 'climb': {
            const l = ladders[currentLadder];
            const targetPlatIdx = l.p2;
            const targetY = platY(targetPlatIdx, hero.x) - 2;
            if(hero.y > targetY + 2){
                hero.y -= CLIMB_SPEED * dt;
            } else {
                hero.y = targetY;
                hero.climbing = false;
                hero.onPlatform = targetPlatIdx;
                currentLadder++;
                stageReached = Math.min(currentLadder, stages.length);
                addSparkle(hero.x, hero.y - 15, stages[Math.min(currentLadder-1, stages.length-1)].color);
                pauseTimer = 0.35;
                if(currentLadder >= ladders.length){
                    phase = 'walk_to_treasure';
                } else {
                    phase = 'walk_to_ladder';
                }
            }
            break;
        }
        case 'walk_to_treasure': {
            const targetX = 480;
            const dx = targetX - hero.x;
            if(Math.abs(dx) > 4){
                hero.dir = dx > 0 ? 1 : -1;
                hero.x += hero.dir * WALK_SPEED * dt;
                if(!hero.jumping) hero.y = platY(hero.onPlatform, hero.x) - 2;
            } else {
                // Trigger GTA SA money pickup
                moneyCollected = true;
                moneyCollectAnim = 0;
                // GTA SA pickup text
                jumpScoreFlash.push({x:hero.x, y:hero.y - 50, life:1.5, val:'+63 840‚ÇΩ'});
                // Delay completion until collection animation plays
                setTimeout(()=>{
                    phase = 'done';
                    completed = true;
                    stageReached = stages.length;
                    addSparkle(hero.x, hero.y - 20, GRN, 15);
                    addSparkle(hero.x-15, hero.y - 25, YLW, 10);
                    addSparkle(hero.x+15, hero.y - 20, '#FF2D6B', 10);
                    addSparkle(hero.x, hero.y - 30, '#4CAF50', 12);
                }, 600);
            }
            break;
        }
    }
}

// ---- Stage labels ----
function drawStageLabels(){
    stages.forEach((s, i)=>{
        const p = platforms[s.platIdx];
        // Alternate left/right
        const isLeft = i % 2 === 0;
        const lx = isLeft ? 55 : W - 55;
        const ly = p.y - 52;
        const align = isLeft ? 'left' : 'right';
        const reached = i < stageReached;
        const active = i === stageReached - 1 || (completed && i === stages.length-1);
        
        ctx.save();
        ctx.textAlign = align;
        
        // Stage label
        ctx.fillStyle = reached || active ? s.color : 'rgba(255,255,255,.2)';
        ctx.font = '8px "Press Start 2P",monospace';
        ctx.fillText(s.label, lx, ly);
        
        // Title with icon
        ctx.fillStyle = reached || active ? WHT : 'rgba(255,255,255,.25)';
        ctx.font = 'bold 15px "Rubik",sans-serif';
        ctx.fillText(s.icon + ' ' + s.title, lx, ly + 18);
        
        // Description
        ctx.fillStyle = reached || active ? 'rgba(255,255,255,.55)' : 'rgba(255,255,255,.15)';
        ctx.font = '11px "Rubik",sans-serif';
        ctx.fillText(s.desc, lx, ly + 34);
        
        // Checkmark
        if(reached){
            const cx = isLeft ? lx - 18 : lx + 10;
            ctx.fillStyle = GRN;
            ctx.font = '12px "Press Start 2P",monospace';
            ctx.textAlign = 'center';
            ctx.fillText('‚úì', cx, ly + 18);
        }
        
        ctx.restore();
    });
}

// ---- GTA SA style spinning money pickup ----
let moneyCollected = false;
let moneyCollectAnim = 0; // 0=not collected, 0‚Üí1 = collecting animation

function drawSpinningMoney(t){
    const x = 480, y = platforms[6].y - 25;
    
    if(moneyCollected && moneyCollectAnim >= 1) return; // fully collected
    
    // Collection animation ‚Äî money flies to hero
    if(moneyCollected){
        moneyCollectAnim = Math.min(moneyCollectAnim + 0.03, 1);
        const ease = 1 - Math.pow(1 - moneyCollectAnim, 3); // ease out cubic
        const mx = x + (hero.x - x) * ease;
        const my = y + (hero.y - 20 - y) * ease;
        const scale = 1 - ease * 0.7;
        ctx.globalAlpha = 1 - ease;
        drawMoneySprite(mx, my, t, scale);
        ctx.globalAlpha = 1;
        
        // Burst of bills flying out
        if(moneyCollectAnim < 0.3){
            for(let i=0;i<2;i++){
                sparkles.push({
                    x:mx + (Math.random()-0.5)*30,
                    y:my + (Math.random()-0.5)*20,
                    vx:(Math.random()-0.5)*5,
                    vy:-Math.random()*3-2,
                    life:0.8, col:'#4CAF50', size:4+Math.random()*4
                });
            }
        }
        return;
    }
    
    // Hovering bounce
    const hover = Math.sin(t*2.5)*4;
    
    // Green glow on ground
    const glowPulse = 0.2 + Math.sin(t*4)*0.1;
    ctx.fillStyle = `rgba(57,255,20,${glowPulse})`;
    ctx.beginPath();
    ctx.arc(x, y + 12, 25, 0, Math.PI*2);
    ctx.fill();
    
    // Rotating green glow ring
    ctx.strokeStyle = `rgba(57,255,20,${0.15 + Math.sin(t*3)*0.1})`;
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(x, y + hover, 30 + Math.sin(t*2)*3, 0, Math.PI*2);
    ctx.stroke();
    
    drawMoneySprite(x, y + hover, t, 1);
    
    // "63 840‚ÇΩ/–º–µ—Å" floating above
    ctx.fillStyle = GRN;
    ctx.font = '8px "Press Start 2P",monospace';
    ctx.textAlign = 'center';
    const labelY = y + hover - 45;
    ctx.fillText('63 840‚ÇΩ', x, labelY);
    ctx.fillStyle = 'rgba(57,255,20,.5)';
    ctx.font = '6px "Press Start 2P",monospace';
    ctx.fillText('/–ú–ï–°', x, labelY + 10);
    ctx.textAlign = 'left';
}

function drawMoneySprite(x, y, t, scale){
    ctx.save();
    ctx.translate(x, y);
    if(scale !== 1) ctx.scale(scale, scale);
    
    // GTA SA 3D spin ‚Äî simulate Y-axis rotation with scaleX
    const spin = t * 3; // rotation speed
    const scaleX = Math.cos(spin); // -1 to 1, simulates 3D flip
    const absScale = Math.abs(scaleX);
    
    // Bundle width changes with rotation (3D effect)
    const bw = 36 * absScale;
    const bh = 22;
    
    if(bw < 2){
        // Edge-on ‚Äî just a thin line
        ctx.fillStyle = '#2E7D32';
        ctx.fillRect(-1, -bh/2, 2, bh);
    } else {
        // Front or back face
        const isFront = scaleX > 0;
        
        // Shadow under bundle
        ctx.fillStyle = 'rgba(0,0,0,.3)';
        ctx.fillRect(-bw/2 + 2, bh/2, bw, 3);
        
        // Stack of bills (3-4 visible)
        for(let i=0; i<4; i++){
            const billY = -bh/2 + bh - (i+1)*5;
            const shade = isFront ? 
                ['#1B5E20','#2E7D32','#388E3C','#43A047'][i] :
                ['#145218','#1E6425','#2B7530','#368B3B'][i];
            ctx.fillStyle = shade;
            ctx.fillRect(-bw/2 + i*1, billY, bw - i*2, 5);
            // Bill detail line
            ctx.fillStyle = 'rgba(255,255,255,.08)';
            ctx.fillRect(-bw/2 + i*1, billY, bw - i*2, 1);
        }
        
        // Money band (red rubber band)
        ctx.fillStyle = '#D32F2F';
        ctx.fillRect(-bw*0.3, -bh/2 + 2, bw*0.6, bh - 4);
        ctx.fillStyle = '#B71C1C';
        ctx.fillRect(-bw*0.3, -bh/2 + 2, bw*0.6, 2);
        ctx.fillRect(-bw*0.3, bh/2 - 4, bw*0.6, 2);
        
        // ‚ÇΩ symbol on the band
        if(bw > 15){
            ctx.fillStyle = '#FFEB3B';
            ctx.font = `${Math.max(6, bw*0.3)|0}px "Press Start 2P",monospace`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('‚ÇΩ', 0, 0);
            ctx.textBaseline = 'alphabetic';
            ctx.textAlign = 'left';
        }
    }
    
    ctx.restore();
}


// ---- HIGH SCORE display (like original) ----
function drawHUD(){
    ctx.fillStyle = RED;
    ctx.font = '11px "Press Start 2P",monospace';
    ctx.textAlign = 'center';
    ctx.fillText('HIGH SCORE', W/2, 22);
    
    ctx.fillStyle = WHT;
    ctx.font = '10px "Press Start 2P",monospace';
    ctx.fillText('063840', W/2, 38);
    
    // Bonus box (top right)
    ctx.strokeStyle = CY;
    ctx.lineWidth = 2;
    ctx.strokeRect(W-140, 10, 110, 38);
    ctx.fillStyle = CY;
    ctx.font = '8px "Press Start 2P",monospace';
    ctx.fillText('BONUS', W-85, 26);
    ctx.fillStyle = CY;
    ctx.font = '11px "Press Start 2P",monospace';
    ctx.fillText('63840', W-85, 42);
    
    // L=01
    ctx.fillStyle = '#4080FF';
    ctx.font = '9px "Press Start 2P",monospace';
    ctx.textAlign = 'right';
    ctx.fillText('L=01', W-150, 26);
    ctx.textAlign = 'left';
}

// ---- Main loop ----
let lastT = 0;

function render(ts){
    requestAnimationFrame(render);
    const dt = Math.min((ts - lastT) / 1000, 0.05);
    lastT = ts;
    animTime += dt;
    
    // Clear
    ctx.fillStyle = BG;
    ctx.fillRect(0, 0, W, H);
    
    // HUD
    drawHUD();
    
    // Platforms
    drawAllPlatforms();
    
    // Ladders
    ladders.forEach(l => drawLadder(l));
    
    // Oil barrel with fire (bottom left)
    drawOilBarrel(55, platforms[0].y, animTime);
    
    // DK gorilla at top
    const dkX = 120;
    const dkY = platforms[5].y - 5;
    drawDK(dkX, dkY, completed ? 0 : animTime);
    
    // Barrel stack next to DK
    drawBarrelStack(dkX - 55, dkY + 5);
    
    // Money stack on prize platform
    drawSpinningMoney(animTime);
    
    // Rolling barrels
    updateBarrels(dt);
    barrels.forEach(b => drawBarrel(b));
    
    // Stage labels
    drawStageLabels();
    
    // Hero
    updateHero(dt);
    if(!started){
        // Idle bob at start
        const bob = Math.sin(animTime*2)*2;
        hero.y = platY(0, hero.x) - 2 + bob;
        drawMario(hero.x, hero.y, false, animTime*6, 1);
    } else {
        drawMario(hero.x, hero.y, hero.climbing, hero.frame, hero.dir);
    }
    
    // Sparkles
    for(let i=sparkles.length-1;i>=0;i--){
        const s=sparkles[i];
        s.x+=s.vx; s.y+=s.vy; s.vy+=0.12; s.life-=dt*2;
        if(s.life<=0){sparkles.splice(i,1);continue;}
        ctx.globalAlpha=s.life;
        ctx.fillStyle=s.col;
        ctx.fillRect(s.x-s.size/2,s.y-s.size/2,s.size,s.size);
    }
    ctx.globalAlpha=1;
    
    // Jump score flashes ("+100" like original DK)
    for(let i=jumpScoreFlash.length-1;i>=0;i--){
        const f=jumpScoreFlash[i];
        f.y -= 40*dt;
        f.life -= dt*1.5;
        if(f.life<=0){jumpScoreFlash.splice(i,1);continue;}
        ctx.globalAlpha=f.life > 1 ? 1 : f.life;
        ctx.fillStyle = typeof f.val === 'string' ? '#4CAF50' : WHT;
        ctx.textAlign='center';
        ctx.font = typeof f.val === 'string' ? '12px "Press Start 2P",monospace' : '10px "Press Start 2P",monospace';
        ctx.fillText(f.val+'', f.x, f.y);
    }
    ctx.globalAlpha=1;
    ctx.textAlign='left';
    
    // Completed overlay
    if(completed){
        ctx.fillStyle = GRN;
        ctx.textAlign = 'center';
        ctx.font = '14px "Press Start 2P",monospace';
        const flash = Math.sin(animTime*4) > 0 ? 1 : 0.5;
        ctx.globalAlpha = flash;
        ctx.fillText('‚òÖ LEVEL COMPLETE! ‚òÖ', W/2, H - 22);
        // GTA SA style money amount flash
        ctx.fillStyle = '#4CAF50';
        ctx.font = '11px "Press Start 2P",monospace';
        ctx.globalAlpha = 0.6 + Math.sin(animTime*5)*0.4;
        ctx.fillText('+63 840‚ÇΩ/–ú–ï–°', W/2, H - 42);
        ctx.globalAlpha = 1;
        ctx.textAlign = 'left';
    }
    
    // Start prompt
    if(!started){
        ctx.fillStyle = YLW;
        ctx.textAlign = 'center';
        ctx.font = '9px "Press Start 2P",monospace';
        const f = Math.sin(animTime*3) > 0 ? 1 : 0.4;
        ctx.globalAlpha = f;
        ctx.fillText('‚ñ∫ –ù–ê–ñ–ú–ò–¢–ï –ß–¢–û–ë–´ –ù–ê–ß–ê–¢–¨ ‚óÑ', W/2, H - 18);
        ctx.globalAlpha = 1;
        ctx.textAlign = 'left';
    }
}

// ---- Start ----
function startClimb(){
    if(started) return;
    started = true;
    hero.x = 80;
    hero.y = platY(0, hero.x) - 2;
    hero.onPlatform = 0;
    hero.climbing = false;
    currentLadder = 0;
    stageReached = 0;
    phase = 'walk_to_ladder';
}

canvas.addEventListener('click', startClimb);
canvas.addEventListener('touchstart', e=>{e.preventDefault();startClimb();},{passive:false});

// Auto-start on scroll into view
const obs = new IntersectionObserver(entries=>{
    if(entries[0].isIntersecting && !started) setTimeout(startClimb, 400);
},{threshold:0.4});
obs.observe(canvas);

hero.x = 80;
hero.y = platY(0, 80) - 2;

requestAnimationFrame(render);
})();
</script>
</body>
</html>
